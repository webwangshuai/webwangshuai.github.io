<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>webpack开发学习记录 | wangshuai</title>
    <meta name="generator" content="VuePress 1.7.1">
    <link rel="icon" href="/favicon.ico">
    <meta name="description" content="webwangshuai、王帅的个人主页">
    <meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no">
    <meta name="keywords" content="webwangshuai,王帅,王帅的个人主页">
    
    <link rel="preload" href="/assets/css/0.styles.c9ed65ae.css" as="style"><link rel="preload" href="/assets/js/app.922f53e3.js" as="script"><link rel="preload" href="/assets/js/3.9c201a8e.js" as="script"><link rel="preload" href="/assets/js/1.1937fc7d.js" as="script"><link rel="preload" href="/assets/js/94.62d30cf6.js" as="script"><link rel="prefetch" href="/assets/js/10.5bd967be.js"><link rel="prefetch" href="/assets/js/11.79ab99b3.js"><link rel="prefetch" href="/assets/js/12.a94b7c71.js"><link rel="prefetch" href="/assets/js/13.7027bfb9.js"><link rel="prefetch" href="/assets/js/14.324f0006.js"><link rel="prefetch" href="/assets/js/15.c0cad9dc.js"><link rel="prefetch" href="/assets/js/16.3c9da92a.js"><link rel="prefetch" href="/assets/js/17.7569b7b4.js"><link rel="prefetch" href="/assets/js/18.6a37d979.js"><link rel="prefetch" href="/assets/js/19.8c5058a9.js"><link rel="prefetch" href="/assets/js/20.27df1b52.js"><link rel="prefetch" href="/assets/js/21.99686568.js"><link rel="prefetch" href="/assets/js/22.ecbd4a82.js"><link rel="prefetch" href="/assets/js/23.4476fe9c.js"><link rel="prefetch" href="/assets/js/24.764e85d1.js"><link rel="prefetch" href="/assets/js/25.fe13c0ae.js"><link rel="prefetch" href="/assets/js/26.2e562fc6.js"><link rel="prefetch" href="/assets/js/27.f40a62d4.js"><link rel="prefetch" href="/assets/js/28.59b23ff3.js"><link rel="prefetch" href="/assets/js/29.7de2dcee.js"><link rel="prefetch" href="/assets/js/30.b42d851b.js"><link rel="prefetch" href="/assets/js/31.f2b8b47a.js"><link rel="prefetch" href="/assets/js/32.357ace34.js"><link rel="prefetch" href="/assets/js/33.fd29be36.js"><link rel="prefetch" href="/assets/js/34.6793858c.js"><link rel="prefetch" href="/assets/js/35.f49192e5.js"><link rel="prefetch" href="/assets/js/36.0e566c71.js"><link rel="prefetch" href="/assets/js/37.6f71a814.js"><link rel="prefetch" href="/assets/js/38.44dfaf42.js"><link rel="prefetch" href="/assets/js/39.8c421f8d.js"><link rel="prefetch" href="/assets/js/4.208e97e4.js"><link rel="prefetch" href="/assets/js/40.0198d4fb.js"><link rel="prefetch" href="/assets/js/41.8e0c64a8.js"><link rel="prefetch" href="/assets/js/42.72093089.js"><link rel="prefetch" href="/assets/js/43.fbb5e5ec.js"><link rel="prefetch" href="/assets/js/44.e012ee35.js"><link rel="prefetch" href="/assets/js/45.241e1509.js"><link rel="prefetch" href="/assets/js/46.ecb77dc5.js"><link rel="prefetch" href="/assets/js/47.2d16347b.js"><link rel="prefetch" href="/assets/js/48.ab9aa6f5.js"><link rel="prefetch" href="/assets/js/49.ed4f7640.js"><link rel="prefetch" href="/assets/js/5.8f78bca2.js"><link rel="prefetch" href="/assets/js/50.7bde890e.js"><link rel="prefetch" href="/assets/js/51.ebc8e61c.js"><link rel="prefetch" href="/assets/js/52.ecc2456b.js"><link rel="prefetch" href="/assets/js/53.c5167e98.js"><link rel="prefetch" href="/assets/js/54.e108640a.js"><link rel="prefetch" href="/assets/js/55.97004b58.js"><link rel="prefetch" href="/assets/js/56.9d893a33.js"><link rel="prefetch" href="/assets/js/57.5061d46f.js"><link rel="prefetch" href="/assets/js/58.c385bbf7.js"><link rel="prefetch" href="/assets/js/59.7bd61f24.js"><link rel="prefetch" href="/assets/js/6.c98cb02a.js"><link rel="prefetch" href="/assets/js/60.6dcf003c.js"><link rel="prefetch" href="/assets/js/61.dcd361c7.js"><link rel="prefetch" href="/assets/js/62.00816917.js"><link rel="prefetch" href="/assets/js/63.8f566a2d.js"><link rel="prefetch" href="/assets/js/64.ac90cf80.js"><link rel="prefetch" href="/assets/js/65.197e4916.js"><link rel="prefetch" href="/assets/js/66.344e4ce5.js"><link rel="prefetch" href="/assets/js/67.9051390c.js"><link rel="prefetch" href="/assets/js/68.41768970.js"><link rel="prefetch" href="/assets/js/69.01f6cfe1.js"><link rel="prefetch" href="/assets/js/7.f9d2a576.js"><link rel="prefetch" href="/assets/js/70.5f7d8f31.js"><link rel="prefetch" href="/assets/js/71.e8f0a37d.js"><link rel="prefetch" href="/assets/js/72.eaa1af81.js"><link rel="prefetch" href="/assets/js/73.6c5fb92d.js"><link rel="prefetch" href="/assets/js/74.869a434b.js"><link rel="prefetch" href="/assets/js/75.2b65bfd9.js"><link rel="prefetch" href="/assets/js/76.10cdf89b.js"><link rel="prefetch" href="/assets/js/77.d85d0931.js"><link rel="prefetch" href="/assets/js/78.38ba4fc1.js"><link rel="prefetch" href="/assets/js/79.12601f72.js"><link rel="prefetch" href="/assets/js/8.f0eaf822.js"><link rel="prefetch" href="/assets/js/80.29c095a1.js"><link rel="prefetch" href="/assets/js/81.8ebcf263.js"><link rel="prefetch" href="/assets/js/82.a5e7088b.js"><link rel="prefetch" href="/assets/js/83.2c70e436.js"><link rel="prefetch" href="/assets/js/84.578e7042.js"><link rel="prefetch" href="/assets/js/85.81fae4b2.js"><link rel="prefetch" href="/assets/js/86.08ed97b5.js"><link rel="prefetch" href="/assets/js/87.049dd6e3.js"><link rel="prefetch" href="/assets/js/88.022880c7.js"><link rel="prefetch" href="/assets/js/89.437a53e8.js"><link rel="prefetch" href="/assets/js/9.ed367937.js"><link rel="prefetch" href="/assets/js/90.f4978568.js"><link rel="prefetch" href="/assets/js/91.d2e9ae76.js"><link rel="prefetch" href="/assets/js/92.02177fd9.js"><link rel="prefetch" href="/assets/js/93.7426d59b.js"><link rel="prefetch" href="/assets/js/95.566dbfcc.js"><link rel="prefetch" href="/assets/js/96.c890d13a.js">
    <link rel="stylesheet" href="/assets/css/0.styles.c9ed65ae.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container" data-v-1156296a><div data-v-1156296a><div id="loader-wrapper" class="loading-wrapper" data-v-d48f4d20 data-v-1156296a data-v-1156296a><div class="loader-main" data-v-d48f4d20><div data-v-d48f4d20></div><div data-v-d48f4d20></div><div data-v-d48f4d20></div><div data-v-d48f4d20></div></div> <!----> <!----></div> <div class="password-shadow password-wrapper-out" style="display:none;" data-v-4e82dffc data-v-1156296a data-v-1156296a><h3 class="title" data-v-4e82dffc data-v-4e82dffc>wangshuai</h3> <p class="description" data-v-4e82dffc data-v-4e82dffc>webwangshuai、王帅的个人主页</p> <label id="box" class="inputBox" data-v-4e82dffc data-v-4e82dffc><input type="password" value="" data-v-4e82dffc> <span data-v-4e82dffc>Konck! Knock!</span> <button data-v-4e82dffc>OK</button></label> <div class="footer" data-v-4e82dffc data-v-4e82dffc><span data-v-4e82dffc><i class="iconfont reco-theme" data-v-4e82dffc></i> <a target="blank" href="https://vuepress-theme-reco.recoluan.com" data-v-4e82dffc>vuePress-theme-reco</a></span> <span data-v-4e82dffc><i class="iconfont reco-copyright" data-v-4e82dffc></i> <a data-v-4e82dffc><span data-v-4e82dffc>wangshuai</span>
            
          <span data-v-4e82dffc>2020 - </span>
          2021
        </a></span></div></div> <div class="hide" data-v-1156296a><header class="navbar" data-v-1156296a><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/avatar.png" alt="wangshuai" class="logo"> <span class="site-name">wangshuai</span></a> <div class="links"><div class="color-picker"><a class="color-button"><i class="iconfont reco-color"></i></a> <div class="color-picker-menu" style="display:none;"><div class="mode-options"><h4 class="title">Choose mode</h4> <ul class="color-mode-options"><li class="dark">dark</li><li class="auto active">auto</li><li class="light">light</li></ul></div></div></div> <div class="search-box"><i class="iconfont reco-search"></i> <input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link"><i class="iconfont reco-home"></i>
  首页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-category"></i>
      分类
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/categories/other/" class="nav-link"><i class="undefined"></i>
  other
</a></li><li class="dropdown-item"><!----> <a href="/categories/算法leetcode/" class="nav-link"><i class="undefined"></i>
  算法leetcode
</a></li><li class="dropdown-item"><!----> <a href="/categories/vue/" class="nav-link"><i class="undefined"></i>
  vue
</a></li><li class="dropdown-item"><!----> <a href="/categories/node/" class="nav-link"><i class="undefined"></i>
  node
</a></li><li class="dropdown-item"><!----> <a href="/categories/react/" class="nav-link"><i class="undefined"></i>
  react
</a></li><li class="dropdown-item"><!----> <a href="/categories/webpack/" class="nav-link"><i class="undefined"></i>
  webpack
</a></li></ul></div></div><div class="nav-item"><a href="/tag/" class="nav-link"><i class="iconfont reco-tag"></i>
  标签
</a></div><div class="nav-item"><a href="/timeline/" class="nav-link"><i class="iconfont reco-date"></i>
  时间轴
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-message"></i>
      文档
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/docs/leetcode/" class="nav-link"><i class="iconfont reco-document"></i>
  算法
</a></li><li class="dropdown-item"><!----> <a href="/docs/vue/" class="nav-link"><i class="iconfont reco-document"></i>
  vue
</a></li><li class="dropdown-item"><!----> <a href="/docs/react/" class="nav-link"><i class="iconfont reco-document"></i>
  react
</a></li><li class="dropdown-item"><!----> <a href="/docs/node/" class="nav-link"><i class="iconfont reco-document"></i>
  node
</a></li><li class="dropdown-item"><!----> <a href="/docs/webpack/" aria-current="page" class="nav-link router-link-exact-active router-link-active"><i class="iconfont reco-document"></i>
  webpack
</a></li><li class="dropdown-item"><!----> <a href="/docs/reactNative/" class="nav-link"><i class="iconfont reco-document"></i>
  reactNative
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-message"></i>
      关于
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://juejin.cn/user/3562073406318712" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="iconfont reco-juejin"></i>
  掘金
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask" data-v-1156296a></div> <aside class="sidebar" data-v-1156296a><div class="personal-info-wrapper" data-v-828910c6 data-v-1156296a><img src="/avatar.png" alt="author-avatar" class="personal-img" data-v-828910c6> <h3 class="name" data-v-828910c6>
    wangshuai
  </h3> <div class="num" data-v-828910c6><div data-v-828910c6><h3 data-v-828910c6>54</h3> <h6 data-v-828910c6>文章</h6></div> <div data-v-828910c6><h3 data-v-828910c6>14</h3> <h6 data-v-828910c6>标签</h6></div></div> <ul class="social-links" data-v-828910c6></ul> <hr data-v-828910c6></div> <nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link"><i class="iconfont reco-home"></i>
  首页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-category"></i>
      分类
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/categories/other/" class="nav-link"><i class="undefined"></i>
  other
</a></li><li class="dropdown-item"><!----> <a href="/categories/算法leetcode/" class="nav-link"><i class="undefined"></i>
  算法leetcode
</a></li><li class="dropdown-item"><!----> <a href="/categories/vue/" class="nav-link"><i class="undefined"></i>
  vue
</a></li><li class="dropdown-item"><!----> <a href="/categories/node/" class="nav-link"><i class="undefined"></i>
  node
</a></li><li class="dropdown-item"><!----> <a href="/categories/react/" class="nav-link"><i class="undefined"></i>
  react
</a></li><li class="dropdown-item"><!----> <a href="/categories/webpack/" class="nav-link"><i class="undefined"></i>
  webpack
</a></li></ul></div></div><div class="nav-item"><a href="/tag/" class="nav-link"><i class="iconfont reco-tag"></i>
  标签
</a></div><div class="nav-item"><a href="/timeline/" class="nav-link"><i class="iconfont reco-date"></i>
  时间轴
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-message"></i>
      文档
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/docs/leetcode/" class="nav-link"><i class="iconfont reco-document"></i>
  算法
</a></li><li class="dropdown-item"><!----> <a href="/docs/vue/" class="nav-link"><i class="iconfont reco-document"></i>
  vue
</a></li><li class="dropdown-item"><!----> <a href="/docs/react/" class="nav-link"><i class="iconfont reco-document"></i>
  react
</a></li><li class="dropdown-item"><!----> <a href="/docs/node/" class="nav-link"><i class="iconfont reco-document"></i>
  node
</a></li><li class="dropdown-item"><!----> <a href="/docs/webpack/" aria-current="page" class="nav-link router-link-exact-active router-link-active"><i class="iconfont reco-document"></i>
  webpack
</a></li><li class="dropdown-item"><!----> <a href="/docs/reactNative/" class="nav-link"><i class="iconfont reco-document"></i>
  reactNative
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-message"></i>
      关于
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://juejin.cn/user/3562073406318712" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="iconfont reco-juejin"></i>
  掘金
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div> <!----></nav> <ul class="sidebar-links"><li><a href="/docs/webpack/" aria-current="page" class="active sidebar-link">webpack开发学习记录</a></li><li><a href="/docs/webpack/1.html" class="sidebar-link">1. webpack基础</a></li><li><a href="/docs/webpack/2.html" class="sidebar-link">2. 前端开发工程环境搭建01</a></li><li><a href="/docs/webpack/3.html" class="sidebar-link">3. webpack工程化实战</a></li><li><a href="/docs/webpack/4.html" class="sidebar-link">4. webpack打包原理分析</a></li></ul> </aside> <div class="password-shadow password-wrapper-in" style="display:none;" data-v-4e82dffc data-v-1156296a><h3 class="title" data-v-4e82dffc data-v-4e82dffc>webpack开发学习记录</h3> <!----> <label id="box" class="inputBox" data-v-4e82dffc data-v-4e82dffc><input type="password" value="" data-v-4e82dffc> <span data-v-4e82dffc>Konck! Knock!</span> <button data-v-4e82dffc>OK</button></label> <div class="footer" data-v-4e82dffc data-v-4e82dffc><span data-v-4e82dffc><i class="iconfont reco-theme" data-v-4e82dffc></i> <a target="blank" href="https://vuepress-theme-reco.recoluan.com" data-v-4e82dffc>vuePress-theme-reco</a></span> <span data-v-4e82dffc><i class="iconfont reco-copyright" data-v-4e82dffc></i> <a data-v-4e82dffc><span data-v-4e82dffc>wangshuai</span>
            
          <span data-v-4e82dffc>2020 - </span>
          2021
        </a></span></div></div> <div data-v-1156296a><main class="page"><section><div class="page-title"><h1 class="title">webpack开发学习记录</h1> <div data-v-1ff7123e><i class="iconfont reco-account" data-v-1ff7123e><span data-v-1ff7123e>wangshuai</span></i> <i class="iconfont reco-date" data-v-1ff7123e><span data-v-1ff7123e>2021-1-5</span></i> <!----> <i class="tags iconfont reco-tag" data-v-1ff7123e><span class="tag-item" data-v-1ff7123e>webpack</span></i></div></div> <div class="theme-reco-content content__default"><h1 id="webpack从入门到进阶"><a href="#webpack从入门到进阶" class="header-anchor">#</a> webpack从入门到进阶</h1> <h1 id="第1章-介绍"><a href="#第1章-介绍" class="header-anchor">#</a> 第1章 介绍</h1> <h2 id="学什么"><a href="#学什么" class="header-anchor">#</a> 学什么</h2> <ul><li><a href="https://www.webpackjs.com" target="_blank" rel="noopener noreferrer">webpack官网<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul> <blockquote><p>本质上，<em>webpack</em> 是一个现代 JavaScript 应用程序的<em>静态模块打包器(module bundler)</em>。当 webpack 处理应用程序时，它会递归地构建一个<em>依赖关系图(dependency graph)</em>，其中包含应用程序需要的每个模块，然后将所有这些模块打包成一个或多个 <em>bundle</em>。</p></blockquote> <p><img src="/webpack/webpack.png" alt="1556458624028"></p> <ul><li>代码转译</li> <li>模块合并</li> <li>混淆压缩</li> <li>代码分割</li> <li>自动刷新</li> <li>代码校验</li> <li>自动部署</li></ul> <h2 id="安排"><a href="#安排" class="header-anchor">#</a> 安排</h2> <ul><li>webpack基础配置</li> <li>webpack高级配置</li> <li>webpack性能优化</li> <li>tapable钩子</li> <li>AST抽象语法树的应用</li> <li>webpack原理分析, 手写webpack</li> <li>手写常见的loader和plugin</li></ul> <h2 id="学习前提"><a href="#学习前提" class="header-anchor">#</a> 学习前提</h2> <ul><li>JS基础</li> <li>ES6 / ES7 语法</li> <li>node基础</li> <li>npm的基本使用</li></ul> <h2 id="目标"><a href="#目标" class="header-anchor">#</a> 目标</h2> <ul><li>掌握webpack的安装</li> <li>掌握webpack的基础配置</li> <li>掌握loader的配置</li> <li>掌握plugin的配置</li> <li>了解webpack性能优化</li> <li>了解webpack中的tapable</li> <li>了解AST的应用</li> <li>深入学习webpack原理，手写webpack</li></ul> <h1 id="第2章-webpack基础"><a href="#第2章-webpack基础" class="header-anchor">#</a> 第2章 webpack基础</h1> <h2 id="webpack的安装"><a href="#webpack的安装" class="header-anchor">#</a> webpack的安装</h2> <p>注意：请先自行安装<a href="https://nodejs.org" target="_blank" rel="noopener noreferrer">nodejs<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>最新版的环境</p> <ul><li><p>全局安装webpack</p> <p><code>npm i webpack webpack-cli -g</code></p></li> <li><p>项目中安装webpack (推荐)</p> <p><code>npm i webpack webpack-cli -D</code></p></li></ul> <h2 id="webpack的使用"><a href="#webpack的使用" class="header-anchor">#</a> webpack的使用</h2> <h3 id="webpack-cli"><a href="#webpack-cli" class="header-anchor">#</a> webpack-cli</h3> <p>npm 5.2 以上的版本中提供了一个<code>npx</code>命令</p> <p>npx 想要解决的主要问题，就是调用项目内部安装的模块，原理就是在<code>node_modules</code>下的<code>.bin</code> 目录中找到对应的命令执行</p> <p>使用webpack命令：<code>npx webpack</code></p> <p>webpack4.0之后可以实现0配置打包构建，0配置的特点就是限制较多，无法自定义很多配置</p> <p>开发中常用的还是使用webpack配置进行打包构建</p> <h3 id="webpack配置"><a href="#webpack配置" class="header-anchor">#</a> webpack配置</h3> <p>webpack有四大核心概念:</p> <ul><li>入口(entry): 程序的入口js</li> <li>输出(output): 打包后存放的位置</li> <li>loader: 用于对模块的源代码进行转换</li> <li>插件(plugins): 插件目的在于解决 loader无法实现的<strong>其他事</strong></li></ul> <ol><li>配置webpack.config.js</li> <li>运行<code>npx webpack</code></li></ol> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token comment">// 入口文件配置</span>
  entry<span class="token operator">:</span> <span class="token string">'./src/index.js'</span><span class="token punctuation">,</span>
  <span class="token comment">// 出口文件配置项</span>
  output<span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token comment">// 输出的路径，webpack2起就规定必须是绝对路径</span>
    path<span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'dist'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token comment">// 输出文件名字</span>
    filename<span class="token operator">:</span> <span class="token string">'bundle.js'</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  mode<span class="token operator">:</span> <span class="token string">'development'</span> <span class="token comment">// 默认为production, 可以手动设置为development, 区别就是是否进行压缩混淆</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><p>将<code>npx webpack</code>命令配置到<code>package.json</code>的脚本中</p> <ol><li>配置<code>package.json</code></li> <li>运行<code>npm run build</code></li></ol> <div class="language-json line-numbers-mode"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;webpack-basic&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;version&quot;</span><span class="token operator">:</span> <span class="token string">&quot;1.0.0&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;main&quot;</span><span class="token operator">:</span> <span class="token string">&quot;index.js&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;license&quot;</span><span class="token operator">:</span> <span class="token string">&quot;MIT&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;scripts&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;build&quot;</span><span class="token operator">:</span> <span class="token string">&quot;webpack&quot;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token property">&quot;devDependencies&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;webpack&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^4.30.0&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;webpack-cli&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^3.3.1&quot;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><h3 id="开发时自动编译工具"><a href="#开发时自动编译工具" class="header-anchor">#</a> 开发时自动编译工具</h3> <p>每次要编译代码时，手动运行 <code>npm run build</code> 就会变得很麻烦。</p> <p>webpack 中有几个不同的选项，可以帮助你在代码发生变化后自动编译代码：</p> <ol><li>webpack's Watch Mode</li> <li>webpack-dev-server</li> <li>webpack-dev-middleware</li></ol> <p>多数场景中，可能需要使用 <code>webpack-dev-server</code>，但是不妨探讨一下以上的所有选项。</p> <h4 id="watch"><a href="#watch" class="header-anchor">#</a> watch</h4> <p>在<code>webpack</code>指令后面加上<code>--watch</code>参数即可</p> <p>主要的作用就是监视本地项目文件的变化, 发现有修改的代码会自动编译打包, 生成输出文件</p> <ol><li><p>配置<code>package.json</code>的scripts<code>&quot;watch&quot;: &quot;webpack --watch&quot;</code></p></li> <li><p>运行<code>npm run watch</code></p></li></ol> <p>以上是cli的方式设置watch的参数</p> <p>还可以通过配置文件对watch的参数进行修改：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span>

<span class="token comment">// webpack的配置文件遵循着CommonJS规范</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  entry<span class="token operator">:</span> <span class="token string">'./src/main.js'</span><span class="token punctuation">,</span>
  output<span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token comment">// path.resolve() : 解析当前相对路径的绝对路径</span>
    <span class="token comment">// path: path.resolve('./dist/'),</span>
    <span class="token comment">// path: path.resolve(__dirname, './dist/'),</span>
    path<span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'./dist/'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    filename<span class="token operator">:</span> <span class="token string">'bundle.js'</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  mode<span class="token operator">:</span> <span class="token string">'development'</span><span class="token punctuation">,</span>
  watch<span class="token operator">:</span> <span class="token boolean">true</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><p>运行<code>npm run build</code></p> <h4 id="webpack-dev-server-推荐"><a href="#webpack-dev-server-推荐" class="header-anchor">#</a> webpack-dev-server (推荐)</h4> <ol><li><p>安装<code>devServer</code>：</p> <p><code>devServer</code>需要依赖<code>webpack</code>，必须在项目依赖中安装<code>webpack</code></p> <p><code>npm i webpack-dev-server webpack -D</code></p></li> <li><p>index.html中修改 <code>&lt;script src=&quot;/bundle.js&quot;&gt;&lt;/script&gt;</code></p></li> <li><p>运行：<code>npx webpack-dev-server</code></p></li> <li><p>运行：<code>npx webpack-dev-server --hot --open --port 8090</code></p></li> <li><p>配置<code>package.json</code>的scripts：<code>&quot;dev&quot;: &quot;webpack-dev-server --hot --open --port 8090&quot;</code></p></li> <li><p>运行<code>npm run dev</code></p></li></ol> <p>devServer会在内存中生成一个打包好的<code>bundle.js</code>，专供开发时使用，打包效率高，修改代码后会自动重新打包以及刷新浏览器，用户体验非常好</p> <p>以上是cli的方式设置devServer的参数</p> <p>还可以通过配置文件对devServer的参数进行修改：</p> <ol><li>修改<code>webpack.config.js</code></li></ol> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token comment">// 入口文件配置</span>
  entry<span class="token operator">:</span> <span class="token string">'./src/index.js'</span><span class="token punctuation">,</span>
  <span class="token comment">// 出口文件配置项</span>
  output<span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token comment">// 输出的路径，webpack2起就规定必须是绝对路径</span>
    path<span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'dist'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token comment">// 输出文件名字</span>
    filename<span class="token operator">:</span> <span class="token string">'bundle.js'</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  devServer<span class="token operator">:</span> <span class="token punctuation">{</span>
    port<span class="token operator">:</span> <span class="token number">8090</span><span class="token punctuation">,</span>
    open<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    hot<span class="token operator">:</span> <span class="token boolean">true</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  mode<span class="token operator">:</span> <span class="token string">'development'</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div><ol start="2"><li>修改package.json的scripts: <code>&quot;dev&quot;: &quot;webpack-dev-server&quot;</code></li> <li>运行<code>npm run dev</code></li></ol> <h4 id="html插件"><a href="#html插件" class="header-anchor">#</a> html插件</h4> <ol><li>安装html-webpack-plugin插件<code>npm i html-webpack-plugin -D</code></li> <li>在<code>webpack.config.js</code>中的<code>plugins</code>节点下配置</li></ol> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> HtmlWebpackPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'html-webpack-plugin'</span><span class="token punctuation">)</span>

plugins<span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token keyword">new</span> <span class="token class-name">HtmlWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        filename<span class="token operator">:</span> <span class="token string">'index.html'</span><span class="token punctuation">,</span>
        template<span class="token operator">:</span> <span class="token string">'template.html'</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">]</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><ol><li>devServer时根据模板在express项目根目录下生成html文件(类似于devServer生成内存中的bundle.js)</li> <li>devServer时自动引入bundle.js</li> <li>打包时会自动生成index.html</li></ol> <h4 id="webpack-dev-middleware"><a href="#webpack-dev-middleware" class="header-anchor">#</a> webpack-dev-middleware</h4> <p><code>webpack-dev-middleware</code> 是一个容器(wrapper)，它可以把 webpack 处理后的文件传递给一个服务器(server)。 <code>webpack-dev-server</code> 在内部使用了它，同时，它也可以作为一个单独的包来使用，以便进行更多自定义设置来实现更多的需求。</p> <ol><li><p>安装 <code>express</code> 和 <code>webpack-dev-middleware</code>：</p> <p><code>npm i express webpack-dev-middleware -D</code></p></li> <li><p>新建<code>server.js</code></p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'express'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> webpack <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'webpack'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> webpackDevMiddleware <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'webpack-dev-middleware'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> config <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./webpack.config.js'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token function">express</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> compiler <span class="token operator">=</span> <span class="token function">webpack</span><span class="token punctuation">(</span>config<span class="token punctuation">)</span><span class="token punctuation">;</span>

app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token function">webpackDevMiddleware</span><span class="token punctuation">(</span>compiler<span class="token punctuation">,</span> <span class="token punctuation">{</span>
  publicPath<span class="token operator">:</span> <span class="token string">'/'</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

app<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">3000</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'http://localhost:3000'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div></li> <li><p>配置<code>package.json</code>中的scripts:<code>&quot;server&quot;: &quot;node server.js&quot;</code></p></li> <li><p>运行: <code>npm run server</code></p></li></ol> <p>注意: 如果要使用<code>webpack-dev-middleware</code>, 必须使用<code>html-webpack-plugin</code>插件, 否则html文件无法正确的输出到express服务器的根目录</p> <h4 id="小结"><a href="#小结" class="header-anchor">#</a> 小结</h4> <p>只有在开发时才需要使用自动编译工具, 例如: webpack-dev-server</p> <p>项目上线时都会直接使用webpack进行打包构建, 不需要使用这些自动编译工具</p> <p>自动编译工具只是为了<strong>提高开发体验</strong></p> <h3 id="处理css"><a href="#处理css" class="header-anchor">#</a> 处理css</h3> <ol><li>安装<code>npm i css-loader style-loader -D</code></li> <li>配置<code>webpack.config.js</code></li></ol> <div class="language-js line-numbers-mode"><pre class="language-js"><code>  module<span class="token operator">:</span> <span class="token punctuation">{</span>
    rules<span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token comment">// 配置的是用来解析.css文件的loader(style-loader和css-loader)</span>
      <span class="token punctuation">{</span>
        <span class="token comment">// 用正则匹配当前访问的文件的后缀名是  .css</span>
        test<span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.css$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
        use<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'style-loader'</span><span class="token punctuation">,</span> <span class="token string">'css-loader'</span><span class="token punctuation">]</span> <span class="token comment">// webpack底层调用这些包的顺序是从右到左</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p>loader的释义:</p> <ol><li>css-loader: 解析css文件</li> <li>style-loader: 将解析出来的结果 放到html中, 使其生效</li></ol> <h3 id="处理less-和-sass"><a href="#处理less-和-sass" class="header-anchor">#</a> 处理less 和 sass</h3> <p><code>npm i less less-loader sass-loader node-sass -D</code></p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token punctuation">{</span> test<span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.less$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span> use<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'style-loader'</span><span class="token punctuation">,</span> <span class="token string">'css-loader'</span><span class="token punctuation">,</span> <span class="token string">'less-loader'</span><span class="token punctuation">]</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token punctuation">{</span> test<span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.scss$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span> use<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'style-loader'</span><span class="token punctuation">,</span> <span class="token string">'css-loader'</span><span class="token punctuation">,</span> <span class="token string">'sass-loader'</span><span class="token punctuation">]</span> <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h3 id="处理图片和字体"><a href="#处理图片和字体" class="header-anchor">#</a> 处理图片和字体</h3> <ol><li><code>npm i file-loader url-loader -D</code></li></ol> <p>url-loader封装了file-loader, 所以使用url-loader时需要安装file-loader</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token punctuation">{</span>
    test<span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.(png|jpg|gif)</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
    use<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span>
        loader<span class="token operator">:</span> <span class="token string">'url-loader'</span><span class="token punctuation">,</span>
        options<span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token comment">// limit表示如果图片大于5KB，就以路径形式展示，小于的话就用base64格式展示</span>
            limit<span class="token operator">:</span> <span class="token number">5</span> <span class="token operator">*</span> <span class="token number">1024</span><span class="token punctuation">,</span>
            <span class="token comment">// 打包输出目录</span>
            outputPath<span class="token operator">:</span> <span class="token string">'images'</span><span class="token punctuation">,</span>
            <span class="token comment">// 打包输出图片名称</span>
            name<span class="token operator">:</span> <span class="token string">'[name]-[hash:4].[ext]'</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><h3 id="babel"><a href="#babel" class="header-anchor">#</a> babel</h3> <ol><li><p><code>npm i babel-loader @babel/core @babel/preset-env webpack -D</code></p></li> <li><p>如果需要支持更高级的ES6语法, 可以继续安装插件:</p> <p><code>npm i @babel/plugin-proposal-class-properties -D</code></p> <p>也可以根据需要在babel官网找插件进行安装</p></li></ol> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token punctuation">{</span>
  test<span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.js$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
  use<span class="token operator">:</span> <span class="token punctuation">{</span>
    loader<span class="token operator">:</span> <span class="token string">'babel-loader'</span><span class="token punctuation">,</span>
    options<span class="token operator">:</span> <span class="token punctuation">{</span>
      presets<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'@babel/env'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
      plugins<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'@babel/plugin-proposal-class-properties'</span><span class="token punctuation">]</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  exclude<span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">node_modules</span><span class="token regex-delimiter">/</span></span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p>官方更建议的做法是在项目根目录下新建一个<code>.babelrc</code>的babel配置文件</p> <div class="language-json line-numbers-mode"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;presets&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;@babel/env&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token property">&quot;plugins&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;@babel/plugin-proposal-class-properties&quot;</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>如果需要使用<code>generator</code>，无法直接使用babel进行转换，因为会将<code>generator</code>转换为一个<code>regeneratorRuntime</code>，然后使用<code>mark</code>和<code>wrap</code>来实现<code>generator</code></p> <p>但由于babel并没有内置<code>regeneratorRuntime</code>，所以无法直接使用</p> <p>需要安装插件:</p> <p>​	<code>npm i @babel/plugin-transform-runtime -D</code></p> <p>同时还需安装运行时依赖:</p> <p>​	<code>npm i @babel/runtime -D</code></p> <p>在<code>.babelrc</code>中添加插件:</p> <div class="language-json line-numbers-mode"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;presets&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token string">&quot;@babel/env&quot;</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token property">&quot;plugins&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token string">&quot;@babel/plugin-proposal-class-properties&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;@babel/plugin-transform-runtime&quot;</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>如果需要使用ES6/7中对象原型提供的新方法，babel默认情况无法转换，即使用了<code>transform-runtime</code>的插件也不支持转换原型上的方法</p> <p>需要使用另一个模块:</p> <p>​	<code>npm i @babel/polyfill -S</code></p> <p>该模块需要在使用新方法的地方直接引入:</p> <p>​	<code>import '@babel/polyfill'</code></p> <h3 id="source-map的使用"><a href="#source-map的使用" class="header-anchor">#</a> source map的使用</h3> <h4 id="devtool"><a href="#devtool" class="header-anchor">#</a> devtool</h4> <p>此选项控制是否生成，以及如何生成 source map。</p> <p>使用 <a href="https://www.webpackjs.com/plugins/source-map-dev-tool-plugin" target="_blank" rel="noopener noreferrer"><code>SourceMapDevToolPlugin</code><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 进行更细粒度的配置。查看 <a href="https://www.webpackjs.com/loaders/source-map-loader" target="_blank" rel="noopener noreferrer"><code>source-map-loader</code><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 来处理已有的 source map。</p> <p>选择一种 <a href="http://blog.teamtreehouse.com/introduction-source-maps" target="_blank" rel="noopener noreferrer">source map<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 格式来增强调试过程。不同的值会明显影响到构建(build)和重新构建(rebuild)的速度。</p> <blockquote><p>可以直接使用 <code>SourceMapDevToolPlugin</code>/<code>EvalSourceMapDevToolPlugin</code> 来替代使用 <code>devtool</code> 选项，它有更多的选项，但是切勿同时使用 <code>devtool</code> 选项和 <code>SourceMapDevToolPlugin</code>/<code>EvalSourceMapDevToolPlugin</code> 插件。因为<code>devtool</code> 选项在内部添加过这些插件，所以会应用两次插件。</p></blockquote> <table><thead><tr><th>devtool</th> <th>构建速度</th> <th>重新构建速度</th> <th>生产环境</th> <th>品质(quality)</th></tr></thead> <tbody><tr><td>(none)</td> <td>+++</td> <td>+++</td> <td>yes</td> <td>打包后的代码</td></tr> <tr><td>eval</td> <td>+++</td> <td>+++</td> <td>no</td> <td>生成后的代码</td></tr> <tr><td>cheap-eval-source-map</td> <td>+</td> <td>++</td> <td>no</td> <td>转换过的代码（仅限行）</td></tr> <tr><td>cheap-module-eval-source-map</td> <td>o</td> <td>++</td> <td>no</td> <td>原始源代码（仅限行）</td></tr> <tr><td>eval-source-map</td> <td>--</td> <td>+</td> <td>no</td> <td>原始源代码</td></tr> <tr><td>cheap-source-map</td> <td>+</td> <td>o</td> <td>no</td> <td>转换过的代码（仅限行）</td></tr> <tr><td>cheap-module-source-map</td> <td>o</td> <td>-</td> <td>no</td> <td>原始源代码（仅限行）</td></tr> <tr><td>inline-cheap-source-map</td> <td>+</td> <td>o</td> <td>no</td> <td>转换过的代码（仅限行）</td></tr> <tr><td>inline-cheap-module-source-map</td> <td>o</td> <td>-</td> <td>no</td> <td>原始源代码（仅限行）</td></tr> <tr><td>source-map</td> <td>--</td> <td>--</td> <td>yes</td> <td>原始源代码</td></tr> <tr><td>inline-source-map</td> <td>--</td> <td>--</td> <td>no</td> <td>原始源代码</td></tr> <tr><td>hidden-source-map</td> <td>--</td> <td>--</td> <td>yes</td> <td>原始源代码</td></tr> <tr><td>nosources-source-map</td> <td>--</td> <td>--</td> <td>yes</td> <td>无源代码内容</td></tr></tbody></table> <h4 id="这么多模式用哪个好"><a href="#这么多模式用哪个好" class="header-anchor">#</a> 这么多模式用哪个好？</h4> <p>开发环境推荐：</p> <p>​	<strong>cheap-module-eval-source-map</strong></p> <p>生产环境推荐：</p> <p>​	<strong>none(不使用source map)</strong></p> <p>原因如下：</p> <ol><li><strong>使用 cheap 模式可以大幅提高 soure map 生成的效率。</strong> 大部分情况我们调试并不关心列信息，而且就算 source map 没有列，有些浏览器引擎（例如 v8） 也会给出列信息。</li> <li><strong>使用 module 可支持 babel 这种预编译工具，映射转换前的代码</strong>。</li> <li><strong>使用 eval 方式可大幅提高持续构建效率。</strong> 官方文档提供的速度对比表格可以看到 eval 模式的重新构建速度都很快。</li> <li><strong>使用 eval-source-map 模式可以减少网络请求。</strong> 这种模式开启 DataUrl 本身包含完整 sourcemap 信息，并不需要像 sourceURL 那样，浏览器需要发送一个完整请求去获取 sourcemap 文件，这会略微提高点效率。而生产环境中则不宜用 eval，这样会让文件变得极大。</li></ol> <h3 id="插件"><a href="#插件" class="header-anchor">#</a> 插件</h3> <h4 id="clean-webpack-plugin"><a href="#clean-webpack-plugin" class="header-anchor">#</a> clean-webpack-plugin</h4> <p>该插件在<code>npm run build</code>时自动清除<code>dist</code>目录后重新生成，非常方便</p> <ol><li><p>安装插件</p> <p><code>npm i clean-webpack-plugin -D</code></p></li> <li><p>引入插件</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> CleanWebpackPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'clean-webpack-plugin'</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div></li> <li><p>使用插件, 在plugins中直接创建对象即可</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>plugins<span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token keyword">new</span> <span class="token class-name">HtmlWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      filename<span class="token operator">:</span> <span class="token string">'index.html'</span><span class="token punctuation">,</span>
      template<span class="token operator">:</span> <span class="token string">'./src/index.html'</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token keyword">new</span> <span class="token class-name">CleanWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">]</span><span class="token punctuation">,</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div></li></ol> <h4 id="copy-webpack-plugin"><a href="#copy-webpack-plugin" class="header-anchor">#</a> copy-webpack-plugin</h4> <ol><li><p>安装插件</p> <p><code>npm i copy-webpack-plugin -D</code></p></li> <li><p>引入插件</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> CopyWebpackPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'copy-webpack-plugin'</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div></li> <li><p>使用插件, 在plugins中插件对象并配置源和目标</p> <p>from: 源, 从哪里拷贝, 可以是相对路径或绝对路径, 推荐绝对路径</p> <p>to: 目标, 拷贝到哪里去, 相对于<code>output</code>的路径, 同样可以相对路径或绝对路径, 但更推荐相对路径(直接算相对dist目录即可)</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>plugins<span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token keyword">new</span> <span class="token class-name">HtmlWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      filename<span class="token operator">:</span> <span class="token string">'index.html'</span><span class="token punctuation">,</span>
      template<span class="token operator">:</span> <span class="token string">'./src/index.html'</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token keyword">new</span> <span class="token class-name">CleanWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token keyword">new</span> <span class="token class-name">CopyWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
      <span class="token punctuation">{</span>
        <span class="token keyword">from</span><span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'assets'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        to<span class="token operator">:</span> <span class="token string">'assets'</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">]</span><span class="token punctuation">)</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div></li></ol> <h4 id="bannerplugin"><a href="#bannerplugin" class="header-anchor">#</a> BannerPlugin</h4> <p>这是一个webpack的内置插件，用于给打包的JS文件加上版权注释信息</p> <ol><li><p>引入webpack</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> webpack <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'webpack'</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div></li> <li><p>创建插件对象</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>plugins<span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token keyword">new</span> <span class="token class-name">HtmlWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      filename<span class="token operator">:</span> <span class="token string">'index.html'</span><span class="token punctuation">,</span>
      template<span class="token operator">:</span> <span class="token string">'./src/index.html'</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token keyword">new</span> <span class="token class-name">CleanWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token keyword">new</span> <span class="token class-name">CopyWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
      <span class="token punctuation">{</span>
        <span class="token keyword">from</span><span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'assets'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        to<span class="token operator">:</span> <span class="token string">'assets'</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token keyword">new</span> <span class="token class-name">webpack<span class="token punctuation">.</span>BannerPlugin</span><span class="token punctuation">(</span><span class="token string">'黑马程序员牛逼!'</span><span class="token punctuation">)</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div></li></ol> <h1 id="第3章-webpack高级配置"><a href="#第3章-webpack高级配置" class="header-anchor">#</a> 第3章 webpack高级配置</h1> <h2 id="html中img标签的图片资源处理"><a href="#html中img标签的图片资源处理" class="header-anchor">#</a> HTML中img标签的图片资源处理</h2> <ol><li><p>安装<code>npm install -S html-withimg-loader</code></p></li> <li><p>在<code>webpack.config.js</code>文件中添加loader</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token punctuation">{</span>
    test<span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.(htm|html)$</span><span class="token regex-delimiter">/</span><span class="token regex-flags">i</span></span><span class="token punctuation">,</span>
    loader<span class="token operator">:</span> <span class="token string">'html-withimg-loader'</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>使用时，只需要在html中正常引用图片即可，webpack会找到对应的资源进行打包，并修改html中的引用路径</p></li></ol> <h2 id="多页应用打包"><a href="#多页应用打包" class="header-anchor">#</a> 多页应用打包</h2> <ol><li><p>在<code>webpack.config.js</code>中修改入口和出口配置</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>  <span class="token comment">// 1. 修改为多入口</span>
  entry<span class="token operator">:</span> <span class="token punctuation">{</span>
      main<span class="token operator">:</span> <span class="token string">'./src/main.js'</span><span class="token punctuation">,</span>
      other<span class="token operator">:</span> <span class="token string">'./src/other.js'</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  output<span class="token operator">:</span> <span class="token punctuation">{</span>
    path<span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'./dist/'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token comment">// filename: 'bundle.js',</span>
    <span class="token comment">// 2. 多入口无法对应一个固定的出口, 所以修改filename为[name]变量</span>
    filename<span class="token operator">:</span> <span class="token string">'[name].js'</span><span class="token punctuation">,</span>
    publicPath<span class="token operator">:</span> <span class="token string">'/'</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  plugins<span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token comment">// 3. 如果用了html插件,需要手动配置多入口对应的html文件,将指定其对应的输出文件</span>
      <span class="token keyword">new</span> <span class="token class-name">HtmlWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
          template<span class="token operator">:</span> <span class="token string">'./index.html'</span><span class="token punctuation">,</span>
          filename<span class="token operator">:</span> <span class="token string">'index.html'</span><span class="token punctuation">,</span>
          chunks<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'main'</span><span class="token punctuation">]</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token keyword">new</span> <span class="token class-name">HtmlWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
          template<span class="token operator">:</span> <span class="token string">'./index.html'</span><span class="token punctuation">,</span>
          filename<span class="token operator">:</span> <span class="token string">'other.html'</span><span class="token punctuation">,</span>
          <span class="token comment">// chunks: ['other', 'main']</span>
          chunks<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'other'</span><span class="token punctuation">]</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">]</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br></div></div></li> <li><p>修改入口为对象，支持多个js入口，同时修改output输出的文件名为<code>'[name].js'</code>表示各自已入口文件名作为输出文件名，但是<code>html-webpack-plugin</code>不支持此功能，所以需要再拷贝一份插件，用于生成两个html页面，实现多页应用</p></li></ol> <h2 id="第三方库的两种引入方式"><a href="#第三方库的两种引入方式" class="header-anchor">#</a> 第三方库的两种引入方式</h2> <p>可以通过<code>expose-loader</code>进行全局变量的注入，同时也可以使用内置插件<code>webpack.ProvidePlugin</code>对每个模块的闭包空间，注入一个变量，自动加载模块，而不必到处 <code>import</code> 或 <code>require</code></p> <ul><li><p>expose-loader <strong>将库引入到全局作用域</strong></p> <ol><li><p>安装<code>expose-loader</code></p> <p><code>npm i -D expose-loader</code></p></li> <li><p>配置loader</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>module<span class="token operator">:</span> <span class="token punctuation">{</span>
  rules<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span>
    test<span class="token operator">:</span> require<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">'jquery'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    use<span class="token operator">:</span> <span class="token punctuation">{</span>
      loader<span class="token operator">:</span> <span class="token string">'expose-loader'</span><span class="token punctuation">,</span>
      options<span class="token operator">:</span> <span class="token string">'$'</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>tips: <code>require.resolve</code> 用来获取模块的绝对路径。所以这里的loader只会作用于 jquery 模块。并且只在 bundle 中使用到它时，才进行处理。</p></li></ol></li> <li><p>webpack.ProvidePlugin <strong>将库自动加载到每个模块</strong></p> <ol><li><p>引入webpack</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> webpack <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'webpack'</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div></li> <li><p>创建插件对象</p> <p>要自动加载 <code>jquery</code>，我们可以将两个变量都指向对应的 node 模块</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">new</span> <span class="token class-name">webpack<span class="token punctuation">.</span>ProvidePlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  $<span class="token operator">:</span> <span class="token string">'jquery'</span><span class="token punctuation">,</span>
  jQuery<span class="token operator">:</span> <span class="token string">'jquery'</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div></li></ol></li></ul> <h2 id="development-production不同配置文件打包"><a href="#development-production不同配置文件打包" class="header-anchor">#</a> Development / Production不同配置文件打包</h2> <p>项目开发时一般需要使用两套配置文件，用于开发阶段打包（不压缩代码，不优化代码，增加效率）和上线阶段打包（压缩代码，优化代码，打包后直接上线使用）</p> <p>抽取三个配置文件：</p> <ul><li><p>webpack.base.js</p></li> <li><p>webpack.prod.js</p></li> <li><p>webpack.dev.js</p></li></ul> <p>步骤如下：</p> <ol><li><p>将开发环境和生产环境公用的配置放入base中，不同的配置各自放入prod或dev文件中（例如：mode）</p></li> <li><p>然后在dev和prod中使用<code>webpack-merge</code>把自己的配置与base的配置进行合并后导出</p> <p><code>npm i -D webpack-merge</code></p></li> <li><p>将package.json中的脚本参数进行修改，通过<code>--config</code>手动指定特定的配置文件</p></li></ol> <h2 id="定义环境变量"><a href="#定义环境变量" class="header-anchor">#</a> 定义环境变量</h2> <p>除了区分不同的配置文件进行打包，还需要在开发时知道当前的环境是开发阶段或上线阶段，所以可以借助内置插件<code>DefinePlugin</code>来定义环境变量。最终可以实现开发阶段与上线阶段的api地址自动切换。</p> <ol><li><p>引入webpack</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> webpack <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'webpack'</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div></li> <li><p>创建插件对象，并定义环境变量</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">new</span> <span class="token class-name">webpack<span class="token punctuation">.</span>DefinePlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token constant">IS_DEV</span><span class="token operator">:</span> <span class="token string">'false'</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div></li> <li><p>在src打包的代码环境下可以直接使用</p></li></ol> <h2 id="使用devserver解决跨域问题"><a href="#使用devserver解决跨域问题" class="header-anchor">#</a> 使用devServer解决跨域问题</h2> <p>在开发阶段很多时候需要使用到跨域，何为跨域？请看下图：</p> <p><img src="/webpack/%E8%B7%A8%E5%9F%9F.png" alt="跨域"></p> <p>开发阶段往往会遇到上面这种情况，也许将来上线后，前端项目会和后端项目部署在同一个服务器下，并不会有跨域问题，但是由于开发时会用到webpack-dev-server，所以一定会产生跨域的问题</p> <p>目前解决跨域主要的方案有：</p> <ol><li>jsonp（淘汰）</li> <li>cors</li> <li>http proxy</li></ol> <p>此处介绍的使用devServer解决跨域，其实原理就是http proxy</p> <p>将所有ajax请求发送给devServer服务器，再由devServer服务器做一次转发，发送给数据接口服务器</p> <p>由于ajax请求是发送给devServer服务器的，所以不存在跨域，而devServer由于是用node平台发送的http请求，自然也不涉及到跨域问题，可以完美解决！</p> <p><img src="/webpack/%E8%A7%A3%E5%86%B3%E8%B7%A8%E5%9F%9F.png" alt="解决跨域"></p> <p>服务器代码（返回一段字符串即可）：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'express'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token function">express</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment">// const cors = require('cors')</span>
<span class="token comment">// app.use(cors())</span>
app<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/api/getUserInfo'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    name<span class="token operator">:</span> <span class="token string">'黑马儿'</span><span class="token punctuation">,</span>
    age<span class="token operator">:</span> <span class="token number">13</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

app<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">9999</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'http://localhost:9999!'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><p>前端需要配置devServer的proxy功能，在<code>webpack.dev.js</code>中进行配置：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>devServer<span class="token operator">:</span> <span class="token punctuation">{</span>
    open<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    hot<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    compress<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    port<span class="token operator">:</span> <span class="token number">3000</span><span class="token punctuation">,</span>
    <span class="token comment">// contentBase: './src'</span>
    proxy<span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token string">'/api'</span><span class="token operator">:</span> <span class="token string">'http://localhost:9999'</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p>意为前端请求<code>/api</code>的url时，webpack-dev-server会将请求转发给<code>http://localhost:9999/api</code>处，此时如果请求地址为<code>http://localhost:9999/api/getUserInfo</code>，只需要直接写<code>/api/getUserInfo</code>即可，代码如下：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>axios<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/api/getUserInfo'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">result</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h2 id="hmr的使用"><a href="#hmr的使用" class="header-anchor">#</a> HMR的使用</h2> <p>需要对某个模块进行热更新时，可以通过<code>module.hot.accept</code>方法进行文件监视</p> <p>只要模块内容发生变化，就会触发回调函数，从而可以重新读取模块内容，做对应的操作</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">if</span> <span class="token punctuation">(</span>module<span class="token punctuation">.</span>hot<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  module<span class="token punctuation">.</span>hot<span class="token punctuation">.</span><span class="token function">accept</span><span class="token punctuation">(</span><span class="token string">'./hotmodule.js'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'hotmodule.js更新了'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> str <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./hotmodule.js'</span><span class="token punctuation">)</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h1 id="第4章-webpack优化"><a href="#第4章-webpack优化" class="header-anchor">#</a> 第4章 webpack优化</h1> <h2 id="production模式打包自带优化"><a href="#production模式打包自带优化" class="header-anchor">#</a> production模式打包自带优化</h2> <ul><li><p>tree shaking</p> <p>tree shaking 是一个术语，通常用于打包时移除 JavaScript 中的未引用的代码(dead-code)，它依赖于 ES6 模块系统中 <code>import</code>和 <code>export</code>的<strong>静态结构</strong>特性。</p> <p>开发时引入一个模块后，如果只使用其中一个功能，上线打包时只会把用到的功能打包进bundle，其他没用到的功能都不会打包进来，可以实现最基础的优化</p></li> <li><p>scope hoisting</p> <p>scope hoisting的作用是将模块之间的关系进行结果推测， 可以让 Webpack 打包出来的代码文件更小、运行的更快</p> <p>scope hoisting 的实现原理其实很简单：分析出模块之间的依赖关系，尽可能的把打散的模块合并到一个函数中去，但前提是不能造成代码冗余。
因此只有那些被引用了一次的模块才能被合并。</p> <p>由于 scope hoisting 需要分析出模块之间的依赖关系，因此源码必须采用 ES6 模块化语句，不然它将无法生效。
原因和tree shaking一样。</p></li> <li><p>代码压缩</p> <p>所有代码使用UglifyJsPlugin插件进行压缩、混淆</p></li></ul> <h2 id="css优化"><a href="#css优化" class="header-anchor">#</a> css优化</h2> <h3 id="将css提取到独立的文件中"><a href="#将css提取到独立的文件中" class="header-anchor">#</a> 将css提取到独立的文件中</h3> <p><code>mini-css-extract-plugin</code>是用于将CSS提取为独立的文件的插件，对每个包含css的js文件都会创建一个CSS文件，支持按需加载css和sourceMap</p> <p>只能用在webpack4中，有如下优势:</p> <ul><li>异步加载</li> <li>不重复编译，性能很好</li> <li>容易使用</li> <li>只针对CSS</li></ul> <p>使用方法：</p> <ol><li><p>安装</p> <p><code>npm i -D mini-css-extract-plugin</code></p></li> <li><p>在webpack配置文件中引入插件</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> MiniCssExtractPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'mini-css-extract-plugin'</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div></li> <li><p>创建插件对象，配置抽离的css文件名，支持placeholder语法</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">new</span> <span class="token class-name">MiniCssExtractPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
	 filename<span class="token operator">:</span> <span class="token string">'[name].css'</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div></li> <li><p>将原来配置的所有<code>style-loader</code>替换为<code>MiniCssExtractPlugin.loader</code></p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token punctuation">{</span>
 test<span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.css$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
 <span class="token comment">// webpack读取loader时 是从右到左的读取, 会将css文件先交给最右侧的loader来处理</span>
 <span class="token comment">// loader的执行顺序是从右到左以管道的方式链式调用</span>
 <span class="token comment">// css-loader: 解析css文件</span>
 <span class="token comment">// style-loader: 将解析出来的结果 放到html中, 使其生效</span>
 <span class="token comment">// use: ['style-loader', 'css-loader']</span>
 use<span class="token operator">:</span> <span class="token punctuation">[</span>MiniCssExtractPlugin<span class="token punctuation">.</span>loader<span class="token punctuation">,</span> <span class="token string">'css-loader'</span><span class="token punctuation">,</span> <span class="token string">'postcss-loader'</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token comment">// { test: /\.less$/, use: ['style-loader', 'css-loader', 'less-loader'] },</span>
<span class="token punctuation">{</span> test<span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.less$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span> use<span class="token operator">:</span> <span class="token punctuation">[</span>MiniCssExtractPlugin<span class="token punctuation">.</span>loader<span class="token punctuation">,</span> <span class="token string">'css-loader'</span><span class="token punctuation">,</span> <span class="token string">'less-loader'</span><span class="token punctuation">]</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token comment">// { test: /\.s(a|c)ss$/, use: ['style-loader', 'css-loader', 'sass-loader'] },</span>
<span class="token punctuation">{</span> test<span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.s(a|c)ss$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span> use<span class="token operator">:</span> <span class="token punctuation">[</span>MiniCssExtractPlugin<span class="token punctuation">.</span>loader<span class="token punctuation">,</span> <span class="token string">'css-loader'</span><span class="token punctuation">,</span> <span class="token string">'sass-loader'</span><span class="token punctuation">]</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div></li></ol> <h3 id="自动添加css前缀"><a href="#自动添加css前缀" class="header-anchor">#</a> 自动添加css前缀</h3> <p>使用<code>postcss</code>，需要用到<code>postcss-loader</code>和<code>autoprefixer</code>插件</p> <ol><li><p>安装</p> <p><code>npm i -D postcss-loader autoprefixer</code></p></li> <li><p>修改webpack配置文件中的loader，将<code>postcss-loader</code>放置在<code>css-loader</code>的右边（调用链从右到左）</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token punctuation">{</span>
 test<span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.css$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
 <span class="token comment">// webpack读取loader时 是从右到左的读取, 会将css文件先交给最右侧的loader来处理</span>
 <span class="token comment">// loader的执行顺序是从右到左以管道的方式链式调用</span>
 <span class="token comment">// css-loader: 解析css文件</span>
 <span class="token comment">// style-loader: 将解析出来的结果 放到html中, 使其生效</span>
 <span class="token comment">// use: ['style-loader', 'css-loader']</span>
 use<span class="token operator">:</span> <span class="token punctuation">[</span>MiniCssExtractPlugin<span class="token punctuation">.</span>loader<span class="token punctuation">,</span> <span class="token string">'css-loader'</span><span class="token punctuation">,</span> <span class="token string">'postcss-loader'</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token comment">// { test: /\.less$/, use: ['style-loader', 'css-loader', 'less-loader'] },</span>
<span class="token punctuation">{</span> test<span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.less$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span> use<span class="token operator">:</span> <span class="token punctuation">[</span>MiniCssExtractPlugin<span class="token punctuation">.</span>loader<span class="token punctuation">,</span> <span class="token string">'css-loader'</span><span class="token punctuation">,</span> <span class="token string">'postcss-loader'</span><span class="token punctuation">,</span> <span class="token string">'less-loader'</span><span class="token punctuation">]</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token comment">// { test: /\.s(a|c)ss$/, use: ['style-loader', 'css-loader', 'sass-loader'] },</span>
<span class="token punctuation">{</span> test<span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.s(a|c)ss$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span> use<span class="token operator">:</span> <span class="token punctuation">[</span>MiniCssExtractPlugin<span class="token punctuation">.</span>loader<span class="token punctuation">,</span> <span class="token string">'css-loader'</span><span class="token punctuation">,</span> <span class="token string">'postcss-loader'</span><span class="token punctuation">,</span> <span class="token string">'sass-loader'</span><span class="token punctuation">]</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div></li> <li><p>项目根目录下添加<code>postcss</code>的配置文件：<code>postcss.config.js</code></p></li> <li><p>在<code>postcss</code>的配置文件中使用插件</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  plugins<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'autoprefixer'</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div></li></ol> <h3 id="开启css压缩"><a href="#开启css压缩" class="header-anchor">#</a> 开启css压缩</h3> <p>需要使用<code>optimize-css-assets-webpack-plugin</code>插件来完成css压缩</p> <p>但是由于配置css压缩时会覆盖掉webpack默认的优化配置，导致JS代码无法压缩，所以还需要手动把JS代码压缩插件导入进来：<code>terser-webpack-plugin</code></p> <ol><li><p>安装</p> <p><code>npm i -D optimize-css-assets-webpack-plugin terser-webpack-plugin</code></p></li> <li><p>导入插件</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> TerserJSPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'terser-webpack-plugin'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> OptimizeCSSAssetsPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'optimize-css-assets-webpack-plugin'</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div></li> <li><p>在webpack配置文件中添加配置节点</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>optimization<span class="token operator">:</span> <span class="token punctuation">{</span>
  minimizer<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token keyword">new</span> <span class="token class-name">TerserJSPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">OptimizeCSSAssetsPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div></li></ol> <p>tips: webpack4默认采用的JS压缩插件为：<code>uglifyjs-webpack-plugin</code>，在<code>mini-css-extract-plugin</code>上一个版本中还推荐使用该插件，但最新的v0.6中建议使用<code>teser-webpack-plugin</code>来完成js代码压缩，具体原因未在官网说明，我们就按照最新版的官方文档来做即可</p> <h2 id="js代码分离"><a href="#js代码分离" class="header-anchor">#</a> js代码分离</h2> <p>Code Splitting是webpack打包时用到的重要的优化特性之一，此特性能够把代码分离到不同的 bundle 中，然后可以按需加载或并行加载这些文件。代码分离可以用于获取更小的 bundle，以及控制资源加载优先级，如果使用合理，会极大影响加载时间。</p> <p>有三种常用的代码分离方法：</p> <ul><li>入口起点(entry points)：使用<code>entry</code>配置手动地分离代码。</li> <li>防止重复(prevent duplication)：使用 <code>SplitChunksPlugin</code>去重和分离 chunk。</li> <li>动态导入(dynamic imports)：通过模块的内联函数调用来分离代码。</li></ul> <h3 id="手动配置多入口"><a href="#手动配置多入口" class="header-anchor">#</a> 手动配置多入口</h3> <ol><li><p>在webpack配置文件中配置多个入口</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>entry<span class="token operator">:</span> <span class="token punctuation">{</span>
  main<span class="token operator">:</span> <span class="token string">'./src/main.js'</span><span class="token punctuation">,</span>
  other<span class="token operator">:</span> <span class="token string">'./src/other.js'</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
output<span class="token operator">:</span> <span class="token punctuation">{</span>
  <span class="token comment">// path.resolve() : 解析当前相对路径的绝对路径</span>
  <span class="token comment">// path: path.resolve('./dist/'),</span>
  <span class="token comment">// path: path.resolve(__dirname, './dist/'),</span>
  path<span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'..'</span><span class="token punctuation">,</span> <span class="token string">'./dist/'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token comment">// filename: 'bundle.js',</span>
  filename<span class="token operator">:</span> <span class="token string">'[name].bundle.js'</span><span class="token punctuation">,</span>
  publicPath<span class="token operator">:</span> <span class="token string">'/'</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div></li> <li><p>在main.js和other.js中都引入同一个模块，并使用其功能</p> <p>main.js</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">import</span> $ <span class="token keyword">from</span> <span class="token string">'jquery'</span>

<span class="token function">$</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'&lt;div&gt;&lt;/div&gt;'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">html</span><span class="token punctuation">(</span><span class="token string">'main'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">appendTo</span><span class="token punctuation">(</span><span class="token string">'body'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>other.js</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">import</span> $ <span class="token keyword">from</span> <span class="token string">'jquery'</span>

<span class="token function">$</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'&lt;div&gt;&lt;/div&gt;'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">html</span><span class="token punctuation">(</span><span class="token string">'other'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">appendTo</span><span class="token punctuation">(</span><span class="token string">'body'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div></li> <li><p>修改package.json的脚本，添加一个使用dev配置文件进行打包的脚本（目的是不压缩代码检查打包的bundle时更方便）</p> <div class="language-json line-numbers-mode"><pre class="language-json"><code><span class="token property">&quot;scripts&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;build&quot;</span><span class="token operator">:</span> <span class="token string">&quot;webpack --config ./build/webpack.prod.js&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;dev-build&quot;</span><span class="token operator">:</span> <span class="token string">&quot;webpack --config ./build/webpack.dev.js&quot;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div></li> <li><p>运行<code>npm run dev-build</code>，进行打包</p></li> <li><p>查看打包后的结果，发现other.bundle.js和main.bundle.js都同时打包了jQuery源文件</p> <p><img src="/webpack/main.bundle.js.png" alt="main"></p> <p><img src="/webpack/other.bundle.js.png" alt="other"></p></li></ol> <p>这种方法存在一些问题:</p> <ul><li>如果入口 chunks 之间包含重复的模块，那些重复模块都会被引入到各个 bundle 中。</li> <li>这种方法不够灵活，并且不能将核心应用程序逻辑进行动态拆分代码。</li></ul> <h3 id="抽取公共代码"><a href="#抽取公共代码" class="header-anchor">#</a> 抽取公共代码</h3> <p>tips: Webpack v4以上使用的插件为<code>SplitChunksPlugin</code>，以前使用的<code>CommonsChunkPlugin</code>已经被移除了，最新版的webpack只需要在配置文件中的<code>optimization</code>节点下添加一个<code>splitChunks</code>属性即可进行相关配置</p> <ol><li><p>修改webpack配置文件</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>optimization<span class="token operator">:</span> <span class="token punctuation">{</span>
    splitChunks<span class="token operator">:</span> <span class="token punctuation">{</span>
      chunks<span class="token operator">:</span> <span class="token string">'all'</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div></li> <li><p>运行<code>npm run dev-build</code>重新打包</p></li> <li><p>查看<code>dist</code>目录</p> <p><img src="/webpack/1558771916946.png" alt="1558771916946"></p></li> <li><p>查看<code>vendors~main~other.bundle.js</code>，其实就是把都用到的jQuery打包到了一个单独的js中</p> <p><img src="/webpack/1558772012664.png" alt="1558772012664"></p></li></ol> <h3 id="动态导入-懒加载"><a href="#动态导入-懒加载" class="header-anchor">#</a> 动态导入 (懒加载)</h3> <p>webpack4默认是允许import语法动态导入的，但是需要babel的插件支持，最新版babel的插件包为：<code>@babel/plugin-syntax-dynamic-import</code>，以前老版本不是<code>@babel</code>开头，已经无法使用，需要注意</p> <p>动态导入最大的好处是实现了懒加载，用到哪个模块才会加载哪个模块，可以提高SPA应用程序的首屏加载速度，Vue、React、Angular框架的路由懒加载原理一样</p> <ol><li><p>安装babel插件</p> <p><code>npm install -D @babel/plugin-syntax-dynamic-import</code></p></li> <li><p>修改.babelrc配置文件，添加<code>@babel/plugin-syntax-dynamic-import</code>插件</p> <div class="language-json line-numbers-mode"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;presets&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;@babel/env&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token property">&quot;plugins&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token string">&quot;@babel/plugin-proposal-class-properties&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;@babel/plugin-transform-runtime&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;@babel/plugin-syntax-dynamic-import&quot;</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div></li> <li><p>将jQuery模块进行动态导入</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">getComponent</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">import</span><span class="token punctuation">(</span><span class="token string">'jquery'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> <span class="token keyword">default</span><span class="token operator">:</span> $ <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'&lt;div&gt;&lt;/div&gt;'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">html</span><span class="token punctuation">(</span><span class="token string">'main'</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div></li> <li><p>给某个按钮添加点击事件，点击后调用getComponent函数创建元素并添加到页面</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>window<span class="token punctuation">.</span><span class="token function-variable function">onload</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'btn'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function-variable function">onclick</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">getComponent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">item</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      item<span class="token punctuation">.</span><span class="token function">appendTo</span><span class="token punctuation">(</span><span class="token string">'body'</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div></li></ol> <h3 id="splitchunksplugin配置参数"><a href="#splitchunksplugin配置参数" class="header-anchor">#</a> SplitChunksPlugin配置参数</h3> <p>webpack4之后，使用<code>SplitChunksPlugin</code>插件替代了以前<code>CommonsChunkPlugin</code></p> <p>而<code>SplitChunksPlugin</code>的配置，只需要在webpack配置文件中的<code>optimization</code>节点下的<code>splitChunks</code>进行修改即可，如果没有任何修改，则会使用默认配置</p> <p>默认的<code>SplitChunksPlugin</code> 配置适用于绝大多数用户</p> <p>webpack 会基于如下默认原则自动分割代码：</p> <ul><li>公用代码块或来自 <em>node_modules</em> 文件夹的组件模块。</li> <li>打包的代码块大小超过 30k（最小化压缩之前）。</li> <li>按需加载代码块时，同时发送的请求最大数量不应该超过 5。</li> <li>页面初始化时，同时发送的请求最大数量不应该超过 3。</li></ul> <p>以下是<code>SplitChunksPlugin</code>的默认配置：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token comment">//...</span>
  optimization<span class="token operator">:</span> <span class="token punctuation">{</span>
    splitChunks<span class="token operator">:</span> <span class="token punctuation">{</span>
      chunks<span class="token operator">:</span> <span class="token string">'async'</span><span class="token punctuation">,</span> <span class="token comment">// 只对异步加载的模块进行拆分，可选值还有all | initial</span>
      minSize<span class="token operator">:</span> <span class="token number">30000</span><span class="token punctuation">,</span> <span class="token comment">// 模块最少大于30KB才拆分</span>
      maxSize<span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>  <span class="token comment">// 模块大小无上限，只要大于30KB都拆分</span>
      minChunks<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token comment">// 模块最少引用一次才会被拆分</span>
      maxAsyncRequests<span class="token operator">:</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token comment">// 异步加载时同时发送的请求数量最大不能超过5,超过5的部分不拆分</span>
      maxInitialRequests<span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token comment">// 页面初始化时同时发送的请求数量最大不能超过3,超过3的部分不拆分</span>
      automaticNameDelimiter<span class="token operator">:</span> <span class="token string">'~'</span><span class="token punctuation">,</span> <span class="token comment">// 默认的连接符</span>
      name<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token comment">// 拆分的chunk名,设为true表示根据模块名和CacheGroup的key来自动生成,使用上面连接符连接</span>
      cacheGroups<span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token comment">// 缓存组配置,上面配置读取完成后进行拆分,如果需要把多个模块拆分到一个文件,就需要缓存,所以命名为缓存组</span>
        vendors<span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token comment">// 自定义缓存组名</span>
          test<span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">[\\/]node_modules[\\/]</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span> <span class="token comment">// 检查node_modules目录,只要模块在该目录下就使用上面配置拆分到这个组</span>
          priority<span class="token operator">:</span> <span class="token operator">-</span><span class="token number">10</span> <span class="token comment">// 权重-10,决定了哪个组优先匹配,例如node_modules下有个模块要拆分,同时满足vendors和default组,此时就会分到vendors组,因为-10 &gt; -20</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token keyword">default</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token comment">// 默认缓存组名</span>
          minChunks<span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token comment">// 最少引用两次才会被拆分</span>
          priority<span class="token operator">:</span> <span class="token operator">-</span><span class="token number">20</span><span class="token punctuation">,</span> <span class="token comment">// 权重-20</span>
          reuseExistingChunk<span class="token operator">:</span> <span class="token boolean">true</span> <span class="token comment">// 如果主入口中引入了两个模块,其中一个正好也引用了后一个,就会直接复用,无需引用两次</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br></div></div><h2 id="noparse"><a href="#noparse" class="header-anchor">#</a> noParse</h2> <p>在引入一些第三方模块时，例如jQuery、bootstrap等，我们知道其内部肯定不会依赖其他模块，因为最终我们用到的只是一个单独的js文件或css文件</p> <p>所以此时如果webpack再去解析他们的内部依赖关系，其实是非常浪费时间的，我们需要阻止webpack浪费精力去解析这些明知道没有依赖的库</p> <p>可以在webpack配置文件的<code>module</code>节点下加上<code>noParse</code>，并配置正则来确定不需要解析依赖关系的模块</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>module<span class="token operator">:</span> <span class="token punctuation">{</span>
	noParse<span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">jquery|bootstrap</span><span class="token regex-delimiter">/</span></span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h2 id="ignoreplugin"><a href="#ignoreplugin" class="header-anchor">#</a> IgnorePlugin</h2> <p>在引入一些第三方模块时，例如moment，内部会做i18n国际化处理，所以会包含很多语言包，而语言包打包时会比较占用空间，如果我们项目只需要用到中文，或者少数语言，可以忽略掉所有的语言包，然后按需引入语言包</p> <p>从而使得构建效率更高，打包生成的文件更小</p> <p>需要忽略第三方模块内部依赖的其他模块，只需要三步：</p> <ol><li>首先要找到moment依赖的语言包是什么</li> <li>使用IgnorePlugin插件忽略其依赖</li> <li>需要使用某些依赖时自行手动引入</li></ol> <p>具体实现如下：</p> <ol><li><p>通过查看moment的源码来分析：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">loadLocale</span><span class="token punctuation">(</span><span class="token parameter">name</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> oldLocale <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token comment">// TODO: Find a better way to register and load all the locales in Node</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>locales<span class="token punctuation">[</span>name<span class="token punctuation">]</span> <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> module <span class="token operator">!==</span> <span class="token string">'undefined'</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span>
        module <span class="token operator">&amp;&amp;</span> module<span class="token punctuation">.</span>exports<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            oldLocale <span class="token operator">=</span> globalLocale<span class="token punctuation">.</span>_abbr<span class="token punctuation">;</span>
            <span class="token keyword">var</span> aliasedRequire <span class="token operator">=</span> require<span class="token punctuation">;</span>
            <span class="token function">aliasedRequire</span><span class="token punctuation">(</span><span class="token string">'./locale/'</span> <span class="token operator">+</span> name<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token function">getSetGlobalLocale</span><span class="token punctuation">(</span>oldLocale<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> locales<span class="token punctuation">[</span>name<span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><p>观察上方代码，同时查看moment目录下确实有locale目录，其中放着所有国家的语言包，可以分析得出：locale目录就是moment所依赖的语言包目录</p></li> <li><p>使用IgnorePlugin插件来忽略掉moment模块的locale目录</p> <p>在webpack配置文件中安装插件，并传入配置项</p> <p>参数1：表示要忽略的资源路径</p> <p>参数2：要忽略的资源上下文（所在哪个目录）</p> <p>两个参数都是正则对象</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">new</span> <span class="token class-name">webpack<span class="token punctuation">.</span>IgnorePlugin</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.\/locale</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">moment</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div></li> <li><p>使用moment时需要手动引入语言包，否则默认使用英文</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">import</span> moment <span class="token keyword">from</span> <span class="token string">'moment'</span>
<span class="token keyword">import</span> <span class="token string">'moment/locale/zh-cn'</span>
moment<span class="token punctuation">.</span><span class="token function">locale</span><span class="token punctuation">(</span><span class="token string">'zh-CN'</span><span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">moment</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">subtract</span><span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">,</span> <span class="token string">'days'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">calendar</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div></li></ol> <h2 id="dllplugin"><a href="#dllplugin" class="header-anchor">#</a> DllPlugin</h2> <p>在引入一些第三方模块时，例如vue、react、angular等框架，这些框架的文件一般都是不会修改的，而每次打包都需要去解析它们，也会影响打包速度，哪怕做拆分，也只是提高了上线后用户访问速度，并不会提高构建速度，所以如果需要提高构建速度，应该使用动态链接库的方式，类似于Windows中的dll文件。</p> <p>借助DllPlugin插件实现将这些框架作为一个个的动态链接库，只构建一次，以后每次构建都只生成自己的业务代码，可以大大提高构建效率！</p> <p>主要思想在于，将一些不做修改的依赖文件，提前打包，这样我们开发代码发布的时候就不需要再对这部分代码进行打包，从而节省了打包时间。</p> <p>涉及两个插件：</p> <ol><li><p>DllPlugin</p> <p>使用一个单独webpack配置创建一个dll文件。并且它还创建一个manifest.json。DllReferencePlugin使用该json文件来做映射依赖性。（这个文件会告诉我们的哪些文件已经提取打包好了）</p> <p>配置参数：</p> <ul><li>context (可选): manifest文件中请求的上下文，默认为该webpack文件上下文。</li> <li>name: 公开的dll函数的名称，和output.library保持一致即可。</li> <li>path: manifest.json生成的文件夹及名字</li></ul></li> <li><p>DllReferencePlugin</p> <p>这个插件用于主webpack配置，它引用的dll需要预先构建的依赖关系。</p> <ul><li><p>context: manifest文件中请求的上下文。</p></li> <li><p>manifest: DllPlugin插件生成的manifest.json</p></li> <li><p>content(可选): 请求的映射模块id(默认为manifest.content)</p></li> <li><p>name(可选): dll暴露的名称</p></li> <li><p>scope(可选): 前缀用于访问dll的内容</p></li> <li><p>sourceType(可选): dll是如何暴露(libraryTarget)</p></li></ul></li></ol> <h3 id="将vue项目中的库抽取成dll"><a href="#将vue项目中的库抽取成dll" class="header-anchor">#</a> 将Vue项目中的库抽取成Dll</h3> <ol><li><p>准备一份将Vue打包成DLL的webpack配置文件</p> <p>在build目录下新建一个文件：webpack.vue.js</p> <p>配置入口：将多个要做成dll的库全放进来</p> <p>配置出口：一定要设置library属性，将打包好的结果暴露在全局</p> <p>配置plugin：设置打包后dll文件名和manifest文件所在地</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> webpack <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'webpack'</span><span class="token punctuation">)</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  mode<span class="token operator">:</span> <span class="token string">'development'</span><span class="token punctuation">,</span>
  entry<span class="token operator">:</span> <span class="token punctuation">{</span>
    vue<span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token string">'vue/dist/vue.js'</span><span class="token punctuation">,</span>
      <span class="token string">'vue-router'</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  output<span class="token operator">:</span> <span class="token punctuation">{</span>
    filename<span class="token operator">:</span> <span class="token string">'[name]_dll.js'</span><span class="token punctuation">,</span>
    path<span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'../dist'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    library<span class="token operator">:</span> <span class="token string">'[name]_dll'</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  plugins<span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token keyword">new</span> <span class="token class-name">webpack<span class="token punctuation">.</span>DllPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      name<span class="token operator">:</span> <span class="token string">'[name]_dll'</span><span class="token punctuation">,</span>
      path<span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'../dist/manifest.json'</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br></div></div></li> <li><p>在webpack.base.js中进行插件的配置</p> <p>使用DLLReferencePlugin指定manifest文件的位置即可</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">new</span> <span class="token class-name">webpack<span class="token punctuation">.</span>DllReferencePlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  manifest<span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'../dist/manifest.json'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div></li> <li><p>安装add-asset-html-webpack-plugin</p> <p><code>npm i add-asset-html-webpack-plugin -D</code></p></li> <li><p>配置插件自动添加script标签到HTML中</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">new</span> <span class="token class-name">AddAssetHtmlWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  filepath<span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'../dist/vue_dll.js'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div></li></ol> <h3 id="将react项目中的库抽取成dll"><a href="#将react项目中的库抽取成dll" class="header-anchor">#</a> 将React项目中的库抽取成Dll</h3> <ol><li><p>准备一份将React打包成DLL的webpack配置文件</p> <p>在build目录下新建一个文件：webpack.vue.js</p> <p>配置入口：将多个要做成dll的库全放进来</p> <p>配置出口：一定要设置library属性，将打包好的结果暴露在全局</p> <p>配置plugin：设置打包后dll文件名和manifest文件所在地</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> webpack <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'webpack'</span><span class="token punctuation">)</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  mode<span class="token operator">:</span> <span class="token string">'development'</span><span class="token punctuation">,</span>
  entry<span class="token operator">:</span> <span class="token punctuation">{</span>
    react<span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token string">'react'</span><span class="token punctuation">,</span>
      <span class="token string">'react-dom'</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  output<span class="token operator">:</span> <span class="token punctuation">{</span>
    filename<span class="token operator">:</span> <span class="token string">'[name]_dll.js'</span><span class="token punctuation">,</span>
    path<span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'../dist'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    library<span class="token operator">:</span> <span class="token string">'[name]_dll'</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  plugins<span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token keyword">new</span> <span class="token class-name">webpack<span class="token punctuation">.</span>DllPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      name<span class="token operator">:</span> <span class="token string">'[name]_dll'</span><span class="token punctuation">,</span>
      path<span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'../dist/manifest.json'</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br></div></div></li> <li><p>在webpack.base.js中进行插件的配置</p> <p>使用DLLReferencePlugin指定manifest文件的位置即可</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">new</span> <span class="token class-name">webpack<span class="token punctuation">.</span>DllReferencePlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  manifest<span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'../dist/manifest.json'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div></li> <li><p>安装add-asset-html-webpack-plugin</p> <p><code>npm i add-asset-html-webpack-plugin -D</code></p></li> <li><p>配置插件自动添加script标签到HTML中</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">new</span> <span class="token class-name">AddAssetHtmlWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  filepath<span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'../dist/react_dll.js'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div></li></ol> <h2 id="happypack"><a href="#happypack" class="header-anchor">#</a> Happypack</h2> <p><img src="/webpack/HappyPack_Workflow.png" alt="A diagram showing the flow between HappyPack's components"></p> <p>由于webpack在node环境中运行打包构建，所以是单线程的模式，在打包众多资源时效率会比较低下，早期可以通过<code>Happypack</code>来实现多进程打包。当然，这个问题只出现在低版本的webpack中，现在的webpack性能已经非常强劲了，所以无需使用Happypack也可以实现高性能打包</p> <p><a href="https://github.com/amireh/happypack" target="_blank" rel="noopener noreferrer">Happypack官网<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p>引用官网原文：</p> <blockquote><p><strong>Maintenance mode notice</strong></p> <p>My interest in the project is fading away mainly because I'm not using JavaScript as much as I was in the past. Additionally, Webpack's native performance is improving and (I hope) it will soon make this plugin unnecessary.</p> <p>See the FAQ entry about Webpack 4 and <a href="https://github.com/webpack-contrib/thread-loader" target="_blank" rel="noopener noreferrer">thread-loader<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>.</p> <p>Contributions are always welcome. Changes I make from this point will be restricted to bug-fixing. If someone wants to take over, feel free to get in touch.</p> <p>Thanks to everyone who used the library, contributed to it and helped in refining it!!!</p></blockquote> <p>由此可以看出作者已经发现，webpack的性能已经强大到不需要使用该插件了，而且小项目使用该插件反而会导致性能损耗过大，因为开启进程是需要耗时的</p> <p>使用方法：</p> <ol><li><p>安装插件</p> <p><code>npm i -D happypack</code></p></li> <li><p>在webpack配置文件中引入插件</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> HappyPack <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'happypack'</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div></li> <li><p>修改loader的配置规则</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token punctuation">{</span>
  test<span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">.js$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
  use<span class="token operator">:</span> <span class="token punctuation">{</span>
      loader<span class="token operator">:</span> <span class="token string">'happypack/loader'</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  include<span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'../src'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  exclude<span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">node_modules</span><span class="token regex-delimiter">/</span></span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div></li> <li><p>配置插件</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">new</span> <span class="token class-name">HappyPack</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    loaders<span class="token operator">:</span> <span class="token punctuation">[</span> <span class="token string">'babel-loader'</span> <span class="token punctuation">]</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div></li> <li><p>运行打包命令</p> <p><code>npm run build</code></p></li></ol> <h2 id="浏览器缓存"><a href="#浏览器缓存" class="header-anchor">#</a> 浏览器缓存</h2> <p>在做了众多代码分离的优化后，其目的是为了利用浏览器缓存，达到提高访问速度的效果，所以构建项目时做代码分割是必须的，例如将固定的第三方模块抽离，下次修改了业务代码，重新发布上线不重启服务器，用户再次访问服务器就不需要再次加载第三方模块了</p> <p>但此时会遇到一个新的问题，如果再次打包上线不重启服务器，客户端会把以前的业务代码和第三方模块同时缓存，再次访问时依旧会访问缓存中的业务代码，所以会导致业务代码也无法更新</p> <p>需要在output节点的filename中使用placeholder语法，根据代码内容生成文件名的hash：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>output<span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token comment">// path.resolve() : 解析当前相对路径的绝对路径</span>
    <span class="token comment">// path: path.resolve('./dist/'),</span>
    <span class="token comment">// path: path.resolve(__dirname, './dist/'),</span>
    path<span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'..'</span><span class="token punctuation">,</span> <span class="token string">'./dist/'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token comment">// filename: 'bundle.js',</span>
    filename<span class="token operator">:</span> <span class="token string">'[name].[contenthash:8].bundle.js'</span><span class="token punctuation">,</span>
    publicPath<span class="token operator">:</span> <span class="token string">'/'</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>之后每次打包业务代码时，如果有改变，会生成新的hash作为文件名，浏览器就不会使用缓存了，而第三方模块不会重新打包生成新的名字，则会继续使用缓存</p> <h2 id="打包分析"><a href="#打包分析" class="header-anchor">#</a> 打包分析</h2> <p>项目构建完成后，需要通过一些工具对打包后的bundle进行分析，通过分析才能总结出一些经验，官方推荐的分析方法有两步完成：</p> <ol><li><p>使用<code>--profile --json</code>参数，以json格式来输出打包后的结果到某个指定文件中</p> <p><code>webpack --profile --json &gt; stats.json</code></p></li> <li><p>将stats.json文件放入工具中进行分析</p> <p>官方工具：<a href="https://github.com/webpack/analyse" target="_blank" rel="noopener noreferrer">official analyze tool<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p>官方推荐的其他四个工具：</p> <ul><li><a href="https://alexkuz.github.io/webpack-chart/" target="_blank" rel="noopener noreferrer">webpack-chart<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://chrisbateman.github.io/webpack-visualizer/" target="_blank" rel="noopener noreferrer">webpack-visualizer<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://github.com/webpack-contrib/webpack-bundle-analyzer" target="_blank" rel="noopener noreferrer">webpack-bundle-analyzer<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://webpack.jakoblind.no/optimize" target="_blank" rel="noopener noreferrer">webpack bundle optimize helper<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul> <p>其中webpack-bundle-analyzer是一个插件，可以以插件的方式安装到项目中</p></li></ol> <h2 id="prefetching和preloading"><a href="#prefetching和preloading" class="header-anchor">#</a> Prefetching和Preloading</h2> <p>在优化访问性能时，除了充分利用浏览器缓存之外，还需要涉及一个性能指标：coverage rate（覆盖率）</p> <p>可以在Chrome浏览器的控制台中按：ctrl  + shift + p，查找coverage，打开覆盖率面板</p> <p>开始录制后刷新网页，即可看到每个js文件的覆盖率，以及总的覆盖率</p> <p><img src="/webpack/1559811338075.png" alt="1559811338075"></p> <p>想提高覆盖率，需要尽可能多的使用动态导入，也就是懒加载功能，将一切能使用懒加载的地方都是用懒加载，这样可以大大提高覆盖率</p> <p>但有时候使用懒加载会影响用户体验，所以可以在懒加载时使用魔法注释：Prefetching，是指在首页资源加载完毕后，空闲时间时，将动态导入的资源加载进来，这样即可以提高首屏加载速度，也可以解决懒加载可能会影响用户体验的问题，一举两得！</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">getComponent</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">import</span><span class="token punctuation">(</span><span class="token comment">/* webpackPrefetch: true */</span> <span class="token string">'jquery'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> <span class="token keyword">default</span><span class="token operator">:</span> $ <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'&lt;div&gt;&lt;/div&gt;'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">html</span><span class="token punctuation">(</span><span class="token string">'我是main'</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h1 id="第5章-webpack原理"><a href="#第5章-webpack原理" class="header-anchor">#</a> 第5章 webpack原理</h1> <h2 id="学习目标"><a href="#学习目标" class="header-anchor">#</a> 学习目标</h2> <ul><li>了解webpack打包原理</li> <li>了解webpack的loader原理</li> <li>了解webpack的插件原理</li> <li>了解ast抽象语法树的应用</li> <li>了解tapable的原理</li> <li>手写一个简单的webpack</li></ul> <h2 id="项目准备工作"><a href="#项目准备工作" class="header-anchor">#</a> 项目准备工作</h2> <ol><li><p>新建一个项目，起一个炫酷的名字</p></li> <li><p>新建<code>bin</code>目录，将打包工具主程序放入其中</p> <p>主程序的顶部应当有：<code>#!/usr/bin/env node</code>标识，指定程序执行环境为node</p></li> <li><p>在<code>package.json</code>中配置<code>bin</code>脚本</p> <div class="language-json line-numbers-mode"><pre class="language-json"><code><span class="token punctuation">{</span>
	<span class="token property">&quot;bin&quot;</span><span class="token operator">:</span> <span class="token string">&quot;./bin/itheima-pack.js&quot;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div></li> <li><p>通过<code>npm link</code>链接到全局包中，供本地测试使用</p></li></ol> <h2 id="分析webpack打包的bundle文件"><a href="#分析webpack打包的bundle文件" class="header-anchor">#</a> 分析webpack打包的bundle文件</h2> <p>其内部就是自己实现了一个<code>__webpack_require__</code>函数，递归导入依赖关系</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">modules</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// webpackBootstrap</span>
  <span class="token comment">// The module cache</span>
  <span class="token keyword">var</span> installedModules <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>

  <span class="token comment">// The require function</span>
  <span class="token keyword">function</span> <span class="token function">__webpack_require__</span><span class="token punctuation">(</span><span class="token parameter">moduleId</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

    <span class="token comment">// Check if module is in cache</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>installedModules<span class="token punctuation">[</span>moduleId<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> installedModules<span class="token punctuation">[</span>moduleId<span class="token punctuation">]</span><span class="token punctuation">.</span>exports<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// Create a new module (and put it into the cache)</span>
    <span class="token keyword">var</span> module <span class="token operator">=</span> installedModules<span class="token punctuation">[</span>moduleId<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
      i<span class="token operator">:</span> moduleId<span class="token punctuation">,</span>
      l<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
      exports<span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>

    <span class="token comment">// Execute the module function</span>
    modules<span class="token punctuation">[</span>moduleId<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>module<span class="token punctuation">.</span>exports<span class="token punctuation">,</span> module<span class="token punctuation">,</span> module<span class="token punctuation">.</span>exports<span class="token punctuation">,</span> __webpack_require__<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// Flag the module as loaded</span>
    module<span class="token punctuation">.</span>l <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>

    <span class="token comment">// Return the exports of the module</span>
    <span class="token keyword">return</span> module<span class="token punctuation">.</span>exports<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// Load entry module and return exports</span>
  <span class="token keyword">return</span> <span class="token function">__webpack_require__</span><span class="token punctuation">(</span>__webpack_require__<span class="token punctuation">.</span>s <span class="token operator">=</span> <span class="token string">&quot;./src/index.js&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token string">&quot;./src/index.js&quot;</span><span class="token operator">:</span>
      <span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">module<span class="token punctuation">,</span> exports<span class="token punctuation">,</span> __webpack_require__</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">eval</span><span class="token punctuation">(</span><span class="token string">&quot;let news = __webpack_require__(/*! ./news.js */ \&quot;./src/news.js\&quot;)\r\nconsole.log(news.content)\n\n//# sourceURL=webpack:///./src/index.js?&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token string">&quot;./src/message.js&quot;</span><span class="token operator">:</span>
      <span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">module<span class="token punctuation">,</span> exports</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">eval</span><span class="token punctuation">(</span><span class="token string">&quot;module.exports = {\r\n  content: '今天要下雨了!!!'\r\n}\n\n//# sourceURL=webpack:///./src/message.js?&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token string">&quot;./src/news.js&quot;</span><span class="token operator">:</span>
      <span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">module<span class="token punctuation">,</span> exports<span class="token punctuation">,</span> __webpack_require__</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">eval</span><span class="token punctuation">(</span><span class="token string">&quot;let message = __webpack_require__(/*! ./message.js */ \&quot;./src/message.js\&quot;)\r\n\r\nmodule.exports = {\r\n  content: '今天有个大新闻,爆炸消息!!!内容是:' + message.content\r\n}\n\n//# sourceURL=webpack:///./src/news.js?&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br></div></div><h2 id="自定义loader"><a href="#自定义loader" class="header-anchor">#</a> 自定义loader</h2> <p>在学习给自己写的itheima-pack工具添加loader功能之前，得先学习webpack中如何自定义loader，所以学习步骤分为两大步：</p> <ol><li>掌握自定义webpack的loader</li> <li>学习给itheima-pack添加loader功能并写一个loader</li></ol> <p>webpack以及我们自己写的itheima-pack都只能处理JavaScript文件，如果需要处理其他文件，或者对JavaScript代码做一些操作，则需要用到loader。</p> <p>loader是webpack中四大核心概念之一，主要功能是将一段匹配规则的代码进行加工处理，生成最终的代码后输出，是webpack打包环节中非常重要的一环。</p> <blockquote><p>loader 可以将所有类型的文件转换为 webpack 能够处理的有效模块，然后你就可以利用 webpack 的打包能力，对它们进行处理。</p></blockquote> <p>之前都使用过别人写好的loader，步骤大致分为：</p> <ol><li>装包</li> <li>在webpack.config.js中配置module节点下的rules即可，例如babel-loader（省略其他配置，只论loader）</li> <li>（可选步骤）可能还需要其他的配置，例如babel需要配置presets和plugin</li></ol> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  entry<span class="token operator">:</span> <span class="token string">'./src/index.js'</span><span class="token punctuation">,</span>
  output<span class="token operator">:</span> <span class="token punctuation">{</span>
    path<span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'dist'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    filename<span class="token operator">:</span> <span class="token string">'bundle.js'</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  module<span class="token operator">:</span> <span class="token punctuation">{</span>
    rules<span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{</span> test<span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.js$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span> use<span class="token operator">:</span> <span class="token string">'babel-loader'</span> <span class="token punctuation">}</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  mode<span class="token operator">:</span> <span class="token string">'development'</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><h3 id="实现一个简单的loader"><a href="#实现一个简单的loader" class="header-anchor">#</a> 实现一个简单的loader</h3> <p>loader到底是什么东西？能不能自己写？</p> <p>答案是肯定的，loader就是一个函数，同样也可以自己来写</p> <ol><li>在项目根目录中新建一个目录存放自己写的loader：</li></ol> <p><img src="/webpack/1561174288710.png" alt="1561174288710"></p> <ol start="2"><li><p>编写myloader.js，其实loader就是对外暴露一个函数</p> <p>第一个参数就是loader要处理的代码</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>module<span class="token punctuation">.</span><span class="token function-variable function">exports</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">source</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>source<span class="token punctuation">)</span> <span class="token comment">// 只是简单打印并返回结果，不作任何处理</span>
  <span class="token keyword">return</span> source
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div></li> <li><p>同样在webpack.config.js中配置自己写的loader，为了方便演示，直接匹配所有的js文件使用自己的myloader进行处理</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  entry<span class="token operator">:</span> <span class="token string">'./src/index.js'</span><span class="token punctuation">,</span>
  output<span class="token operator">:</span> <span class="token punctuation">{</span>
    path<span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'dist'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    filename<span class="token operator">:</span> <span class="token string">'bundle.js'</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  module<span class="token operator">:</span> <span class="token punctuation">{</span>
    rules<span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{</span> test<span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">.js$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span> use<span class="token operator">:</span> <span class="token string">'./loaders/myloader.js'</span> <span class="token punctuation">}</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  mode<span class="token operator">:</span> <span class="token string">'development'</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div></li> <li><p>如果需要实现一个简单的loader，例如将js中所有的“今天”替换成“明天”</p> <p>只需要修改myloader.js的内容如下即可</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>module<span class="token punctuation">.</span><span class="token function-variable function">exports</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">source</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> source<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">今天</span><span class="token regex-delimiter">/</span><span class="token regex-flags">g</span></span><span class="token punctuation">,</span> <span class="token string">'明天'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div></li> <li><p>同时也可以配置多个loader对代码进行处理</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  entry<span class="token operator">:</span> <span class="token string">'./src/index.js'</span><span class="token punctuation">,</span>
  output<span class="token operator">:</span> <span class="token punctuation">{</span>
    path<span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'dist'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    filename<span class="token operator">:</span> <span class="token string">'bundle.js'</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  module<span class="token operator">:</span> <span class="token punctuation">{</span>
    rules<span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{</span> test<span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">.js$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span> use<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'./loaders/myloader2.js'</span><span class="token punctuation">,</span> <span class="token string">'./loaders/myloader.js'</span><span class="token punctuation">]</span> <span class="token punctuation">}</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  mode<span class="token operator">:</span> <span class="token string">'development'</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div></li> <li><p>myloader2.js</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>module<span class="token punctuation">.</span><span class="token function-variable function">exports</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">source</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> source<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">爆炸</span><span class="token regex-delimiter">/</span><span class="token regex-flags">g</span></span><span class="token punctuation">,</span> <span class="token string">'小道'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div></li></ol> <h3 id="loader的分类"><a href="#loader的分类" class="header-anchor">#</a> loader的分类</h3> <p>不同类型的loader加载时优先级不同，优先级顺序遵循：</p> <p>前置 &gt; 行内 &gt; 普通 &gt; 后置</p> <p>pre: 前置loader</p> <p>post: 后置loader</p> <p>指定Rule.enforce的属性即可设置loader的种类，不设置默认为普通loader</p> <h3 id="在itheima-pack中添加loader的功能"><a href="#在itheima-pack中添加loader的功能" class="header-anchor">#</a> 在itheima-pack中添加loader的功能</h3> <p>通过配置loader和手写loader可以发现，其实webpack能支持loader，主要步骤如下：</p> <ol><li>读取webpack.config.js配置文件的module.rules配置项，进行倒序迭代（rules的每项匹配规则按倒序匹配）</li> <li>根据正则匹配到对应的文件类型，同时再批量导入loader函数</li> <li>倒序迭代调用所有loader函数（loader的加载顺序从右到左，也是倒叙）</li> <li>最后返回处理后的代码</li></ol> <p>在实现itheima-pack的loader功能时，同样也可以在加载每个模块时，根据rules的正则来匹配是否满足条件，如果满足条件则加载对应的loader函数并迭代调用</p> <p>depAnalyse()方法中获取到源码后，读取loader：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">let</span> rules <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>config<span class="token punctuation">.</span>module<span class="token punctuation">.</span>rules
<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> rules<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&gt;=</span> <span class="token number">0</span><span class="token punctuation">;</span> i<span class="token operator">--</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// console.log(rules[i])</span>
    <span class="token keyword">let</span> <span class="token punctuation">{</span>test<span class="token punctuation">,</span> use<span class="token punctuation">}</span> <span class="token operator">=</span> rules<span class="token punctuation">[</span>i<span class="token punctuation">]</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>test<span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>modulePath<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> j <span class="token operator">=</span> use<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span> j <span class="token operator">&gt;=</span> <span class="token number">0</span><span class="token punctuation">;</span> j<span class="token operator">--</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">let</span> loaderPath <span class="token operator">=</span> path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>root<span class="token punctuation">,</span> use<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">)</span>
            <span class="token keyword">let</span> loader <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span>loaderPath<span class="token punctuation">)</span>
            source <span class="token operator">=</span> <span class="token function">loader</span><span class="token punctuation">(</span>source<span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><h2 id="自定义插件"><a href="#自定义插件" class="header-anchor">#</a> 自定义插件</h2></div></section> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><!----> <span class="next"><a href="/docs/webpack/1.html">
            1. webpack基础
          </a></span></p></div> <div class="comments-wrapper"><!----></div> <ul class="side-bar sub-sidebar-wrapper" style="width:12rem;" data-v-70334359><li class="level-2" data-v-70334359><a href="/docs/webpack/#学什么" class="sidebar-link reco-side-学什么" data-v-70334359>学什么</a></li><li class="level-2" data-v-70334359><a href="/docs/webpack/#安排" class="sidebar-link reco-side-安排" data-v-70334359>安排</a></li><li class="level-2" data-v-70334359><a href="/docs/webpack/#学习前提" class="sidebar-link reco-side-学习前提" data-v-70334359>学习前提</a></li><li class="level-2" data-v-70334359><a href="/docs/webpack/#目标" class="sidebar-link reco-side-目标" data-v-70334359>目标</a></li><li class="level-2" data-v-70334359><a href="/docs/webpack/#webpack的安装" class="sidebar-link reco-side-webpack的安装" data-v-70334359>webpack的安装</a></li><li class="level-2" data-v-70334359><a href="/docs/webpack/#webpack的使用" class="sidebar-link reco-side-webpack的使用" data-v-70334359>webpack的使用</a></li><li class="level-3" data-v-70334359><a href="/docs/webpack/#webpack-cli" class="sidebar-link reco-side-webpack-cli" data-v-70334359>webpack-cli</a></li><li class="level-3" data-v-70334359><a href="/docs/webpack/#webpack配置" class="sidebar-link reco-side-webpack配置" data-v-70334359>webpack配置</a></li><li class="level-3" data-v-70334359><a href="/docs/webpack/#开发时自动编译工具" class="sidebar-link reco-side-开发时自动编译工具" data-v-70334359>开发时自动编译工具</a></li><li class="level-3" data-v-70334359><a href="/docs/webpack/#处理css" class="sidebar-link reco-side-处理css" data-v-70334359>处理css</a></li><li class="level-3" data-v-70334359><a href="/docs/webpack/#处理less-和-sass" class="sidebar-link reco-side-处理less-和-sass" data-v-70334359>处理less 和 sass</a></li><li class="level-3" data-v-70334359><a href="/docs/webpack/#处理图片和字体" class="sidebar-link reco-side-处理图片和字体" data-v-70334359>处理图片和字体</a></li><li class="level-3" data-v-70334359><a href="/docs/webpack/#babel" class="sidebar-link reco-side-babel" data-v-70334359>babel</a></li><li class="level-3" data-v-70334359><a href="/docs/webpack/#source-map的使用" class="sidebar-link reco-side-source-map的使用" data-v-70334359>source map的使用</a></li><li class="level-3" data-v-70334359><a href="/docs/webpack/#插件" class="sidebar-link reco-side-插件" data-v-70334359>插件</a></li><li class="level-2" data-v-70334359><a href="/docs/webpack/#html中img标签的图片资源处理" class="sidebar-link reco-side-html中img标签的图片资源处理" data-v-70334359>HTML中img标签的图片资源处理</a></li><li class="level-2" data-v-70334359><a href="/docs/webpack/#多页应用打包" class="sidebar-link reco-side-多页应用打包" data-v-70334359>多页应用打包</a></li><li class="level-2" data-v-70334359><a href="/docs/webpack/#第三方库的两种引入方式" class="sidebar-link reco-side-第三方库的两种引入方式" data-v-70334359>第三方库的两种引入方式</a></li><li class="level-2" data-v-70334359><a href="/docs/webpack/#development-production不同配置文件打包" class="sidebar-link reco-side-development-production不同配置文件打包" data-v-70334359>Development / Production不同配置文件打包</a></li><li class="level-2" data-v-70334359><a href="/docs/webpack/#定义环境变量" class="sidebar-link reco-side-定义环境变量" data-v-70334359>定义环境变量</a></li><li class="level-2" data-v-70334359><a href="/docs/webpack/#使用devserver解决跨域问题" class="sidebar-link reco-side-使用devserver解决跨域问题" data-v-70334359>使用devServer解决跨域问题</a></li><li class="level-2" data-v-70334359><a href="/docs/webpack/#hmr的使用" class="sidebar-link reco-side-hmr的使用" data-v-70334359>HMR的使用</a></li><li class="level-2" data-v-70334359><a href="/docs/webpack/#production模式打包自带优化" class="sidebar-link reco-side-production模式打包自带优化" data-v-70334359>production模式打包自带优化</a></li><li class="level-2" data-v-70334359><a href="/docs/webpack/#css优化" class="sidebar-link reco-side-css优化" data-v-70334359>css优化</a></li><li class="level-3" data-v-70334359><a href="/docs/webpack/#将css提取到独立的文件中" class="sidebar-link reco-side-将css提取到独立的文件中" data-v-70334359>将css提取到独立的文件中</a></li><li class="level-3" data-v-70334359><a href="/docs/webpack/#自动添加css前缀" class="sidebar-link reco-side-自动添加css前缀" data-v-70334359>自动添加css前缀</a></li><li class="level-3" data-v-70334359><a href="/docs/webpack/#开启css压缩" class="sidebar-link reco-side-开启css压缩" data-v-70334359>开启css压缩</a></li><li class="level-2" data-v-70334359><a href="/docs/webpack/#js代码分离" class="sidebar-link reco-side-js代码分离" data-v-70334359>js代码分离</a></li><li class="level-3" data-v-70334359><a href="/docs/webpack/#手动配置多入口" class="sidebar-link reco-side-手动配置多入口" data-v-70334359>手动配置多入口</a></li><li class="level-3" data-v-70334359><a href="/docs/webpack/#抽取公共代码" class="sidebar-link reco-side-抽取公共代码" data-v-70334359>抽取公共代码</a></li><li class="level-3" data-v-70334359><a href="/docs/webpack/#动态导入-懒加载" class="sidebar-link reco-side-动态导入-懒加载" data-v-70334359>动态导入 (懒加载)</a></li><li class="level-3" data-v-70334359><a href="/docs/webpack/#splitchunksplugin配置参数" class="sidebar-link reco-side-splitchunksplugin配置参数" data-v-70334359>SplitChunksPlugin配置参数</a></li><li class="level-2" data-v-70334359><a href="/docs/webpack/#noparse" class="sidebar-link reco-side-noparse" data-v-70334359>noParse</a></li><li class="level-2" data-v-70334359><a href="/docs/webpack/#ignoreplugin" class="sidebar-link reco-side-ignoreplugin" data-v-70334359>IgnorePlugin</a></li><li class="level-2" data-v-70334359><a href="/docs/webpack/#dllplugin" class="sidebar-link reco-side-dllplugin" data-v-70334359>DllPlugin</a></li><li class="level-3" data-v-70334359><a href="/docs/webpack/#将vue项目中的库抽取成dll" class="sidebar-link reco-side-将vue项目中的库抽取成dll" data-v-70334359>将Vue项目中的库抽取成Dll</a></li><li class="level-3" data-v-70334359><a href="/docs/webpack/#将react项目中的库抽取成dll" class="sidebar-link reco-side-将react项目中的库抽取成dll" data-v-70334359>将React项目中的库抽取成Dll</a></li><li class="level-2" data-v-70334359><a href="/docs/webpack/#happypack" class="sidebar-link reco-side-happypack" data-v-70334359>Happypack</a></li><li class="level-2" data-v-70334359><a href="/docs/webpack/#浏览器缓存" class="sidebar-link reco-side-浏览器缓存" data-v-70334359>浏览器缓存</a></li><li class="level-2" data-v-70334359><a href="/docs/webpack/#打包分析" class="sidebar-link reco-side-打包分析" data-v-70334359>打包分析</a></li><li class="level-2" data-v-70334359><a href="/docs/webpack/#prefetching和preloading" class="sidebar-link reco-side-prefetching和preloading" data-v-70334359>Prefetching和Preloading</a></li><li class="level-2" data-v-70334359><a href="/docs/webpack/#学习目标" class="sidebar-link reco-side-学习目标" data-v-70334359>学习目标</a></li><li class="level-2" data-v-70334359><a href="/docs/webpack/#项目准备工作" class="sidebar-link reco-side-项目准备工作" data-v-70334359>项目准备工作</a></li><li class="level-2" data-v-70334359><a href="/docs/webpack/#分析webpack打包的bundle文件" class="sidebar-link reco-side-分析webpack打包的bundle文件" data-v-70334359>分析webpack打包的bundle文件</a></li><li class="level-2" data-v-70334359><a href="/docs/webpack/#自定义loader" class="sidebar-link reco-side-自定义loader" data-v-70334359>自定义loader</a></li><li class="level-3" data-v-70334359><a href="/docs/webpack/#实现一个简单的loader" class="sidebar-link reco-side-实现一个简单的loader" data-v-70334359>实现一个简单的loader</a></li><li class="level-3" data-v-70334359><a href="/docs/webpack/#loader的分类" class="sidebar-link reco-side-loader的分类" data-v-70334359>loader的分类</a></li><li class="level-3" data-v-70334359><a href="/docs/webpack/#在itheima-pack中添加loader的功能" class="sidebar-link reco-side-在itheima-pack中添加loader的功能" data-v-70334359>在itheima-pack中添加loader的功能</a></li><li class="level-2" data-v-70334359><a href="/docs/webpack/#自定义插件" class="sidebar-link reco-side-自定义插件" data-v-70334359>自定义插件</a></li></ul></main> <!----></div></div></div></div><div class="global-ui"><div class="back-to-ceiling" style="right:1rem;bottom:6rem;width:2.5rem;height:2.5rem;border-radius:.25rem;line-height:2.5rem;display:none;" data-v-c6073ba8 data-v-c6073ba8><svg t="1574745035067" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="5404" class="icon" data-v-c6073ba8><path d="M526.60727968 10.90185116a27.675 27.675 0 0 0-29.21455937 0c-131.36607665 82.28402758-218.69155461 228.01873535-218.69155402 394.07834331a462.20625001 462.20625001 0 0 0 5.36959153 69.94390903c1.00431239 6.55289093-0.34802892 13.13561351-3.76865779 18.80351572-32.63518765 54.11355614-51.75690182 118.55860487-51.7569018 187.94566865a371.06718723 371.06718723 0 0 0 11.50484808 91.98906777c6.53300375 25.50556257 41.68394495 28.14064038 52.69160883 4.22606766 17.37162448-37.73630017 42.14135425-72.50938081 72.80769204-103.21549295 2.18761121 3.04276886 4.15646224 6.24463696 6.40373557 9.22774369a1871.4375 1871.4375 0 0 0 140.04691725 5.34970492 1866.36093723 1866.36093723 0 0 0 140.04691723-5.34970492c2.24727335-2.98310674 4.21612437-6.18497483 6.3937923-9.2178004 30.66633723 30.70611158 55.4360664 65.4791928 72.80769147 103.21549355 11.00766384 23.91457269 46.15860503 21.27949489 52.69160879-4.22606768a371.15156223 371.15156223 0 0 0 11.514792-91.99901164c0-69.36717486-19.13165746-133.82216804-51.75690182-187.92578088-3.42062944-5.66790279-4.76302748-12.26056868-3.76865837-18.80351632a462.20625001 462.20625001 0 0 0 5.36959269-69.943909c-0.00994388-166.08943902-87.32547796-311.81420293-218.6915546-394.09823051zM605.93803103 357.87693858a93.93749974 93.93749974 0 1 1-187.89594924 6.1e-7 93.93749974 93.93749974 0 0 1 187.89594924-6.1e-7z" p-id="5405" data-v-c6073ba8></path><path d="M429.50777625 765.63860547C429.50777625 803.39355007 466.44236686 1000.39046097 512.00932183 1000.39046097c45.56695499 0 82.4922232-197.00623328 82.5015456-234.7518555 0-37.75494459-36.9345906-68.35043303-82.4922232-68.34111062-45.57627738-0.00932239-82.52019037 30.59548842-82.51086798 68.34111062z" p-id="5406" data-v-c6073ba8></path></svg></div></div></div>
    <script src="/assets/js/app.922f53e3.js" defer></script><script src="/assets/js/3.9c201a8e.js" defer></script><script src="/assets/js/1.1937fc7d.js" defer></script><script src="/assets/js/94.62d30cf6.js" defer></script>
  </body>
</html>
