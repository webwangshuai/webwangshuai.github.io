(window.webpackJsonp=window.webpackJsonp||[]).push([[27],{521:function(t,s,a){"use strict";a.r(s);var n=a(6),e=Object(n.a)({},(function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h2",{attrs:{id:"本章重点"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#本章重点"}},[t._v("#")]),t._v(" 本章重点")]),t._v(" "),a("ul",[a("li",[t._v("环境搭建")]),t._v(" "),a("li",[t._v("掌握源码学习方法")]),t._v(" "),a("li",[t._v("vue初始化过程剖析")]),t._v(" "),a("li",[t._v("深入理解数据响应式")])]),t._v(" "),a("p",[a("a",{attrs:{href:"https://github.com/vuejs/vue",target:"_blank",rel:"noopener noreferrer"}},[t._v("vuejs源码github地址"),a("OutboundLink")],1)]),t._v(" "),a("h2",{attrs:{id:"文件结构"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#文件结构"}},[t._v("#")]),t._v(" 文件结构")]),t._v(" "),a("p",[a("img",{attrs:{src:"/vue/01.png",alt:"文件结构"}})]),t._v(" "),a("p",[t._v("源码目录"),a("br"),t._v(" "),a("img",{attrs:{src:"/vue/02.png",alt:"文件结构"}})]),t._v(" "),a("h2",{attrs:{id:"调试环境搭建"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#调试环境搭建"}},[t._v("#")]),t._v(" 调试环境搭建")]),t._v(" "),a("ul",[a("li",[t._v("安装依赖： npm i")])]),t._v(" "),a("blockquote",[a("p",[t._v("安装phantom.js时即可终止")])]),t._v(" "),a("ul",[a("li",[t._v("安装rollup： npm i -g rollup")]),t._v(" "),a("li",[t._v("修改dev脚本，添加sourcemap，package.json")])]),t._v(" "),a("div",{staticClass:"language-js line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"dev"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"rollup -w -c scripts/config.js --sourcemap --environment TARGET:webfull-dev"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br")])]),a("blockquote",[a("p",[t._v("术语解释：")]),t._v(" "),a("ul",[a("li",[t._v("runtime：仅包含运行时，不包含编译器")]),t._v(" "),a("li",[t._v("common：cjs规范，用于webpack1")]),t._v(" "),a("li",[t._v("esm：ES模块，用于webpack2+")]),t._v(" "),a("li",[t._v("umd: universal module definition，兼容cjs和amd，用于浏览器")])])]),t._v(" "),a("h2",{attrs:{id:"初始化流程"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#初始化流程"}},[t._v("#")]),t._v(" 初始化流程")]),t._v(" "),a("h3",{attrs:{id:"整体流程"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#整体流程"}},[t._v("#")]),t._v(" 整体流程")]),t._v(" "),a("ul",[a("li",[t._v("new Vue()\n"),a("ul",[a("li",[t._v("_init()")])])]),t._v(" "),a("li",[t._v("$mount()\n"),a("ul",[a("li",[t._v("mountComponent()\n"),a("ul",[a("li",[t._v("updateComponent()\n"),a("ul",[a("li",[t._v("render()")]),t._v(" "),a("li",[t._v("update()")])])]),t._v(" "),a("li",[t._v("new Watcher()")])])])])])]),t._v(" "),a("p",[a("img",{attrs:{src:"/vue/03.png",alt:"生命周期图示"}})]),t._v(" "),a("blockquote",[a("p",[a("a",{attrs:{href:"https://cn.vuejs.org/v2/guide/instance.html#%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F%E5%9B%BE%E7%A4%BA",target:"_blank",rel:"noopener noreferrer"}},[t._v("生命周期图示"),a("OutboundLink")],1)])]),t._v(" "),a("h3",{attrs:{id:"入口-platforms-web-entry-runtime-with-compiler-js"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#入口-platforms-web-entry-runtime-with-compiler-js"}},[t._v("#")]),t._v(" 入口 platforms/web/entry-runtime-with-compiler.js")]),t._v(" "),a("p",[t._v("扩展默认$mount方法：处理template或el选项")]),t._v(" "),a("h3",{attrs:{id:"platforms-web-runtime-index-js"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#platforms-web-runtime-index-js"}},[t._v("#")]),t._v(" platforms/web/runtime/index.js")]),t._v(" "),a("p",[t._v("安装web平台特有指令和组件"),a("br"),t._v("\n定义__patch__：补丁函数，执行patching算法进行更新"),a("br"),t._v("\n定义$mount：挂载vue实例到指定宿主元素（获得dom并替换宿主元素）")]),t._v(" "),a("h3",{attrs:{id:"core-index-js"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#core-index-js"}},[t._v("#")]),t._v(" core/index.js")]),t._v(" "),a("p",[t._v("初始化全局api"),a("br"),t._v("\n具体如下：")]),t._v(" "),a("div",{staticClass:"language-js line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[t._v("Vue"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("set "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("set")]),t._v("\nVue"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("delete "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" del\nVue"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("nextTick "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" nextTick\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("initUse")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("Vue"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 实现Vue.use函数")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("initMixin")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("Vue"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 实现Vue.mixin函数")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("initExtend")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("Vue"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 实现Vue.extend函数")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("initAssetRegisters")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("Vue"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 注册实现Vue.component/directive/filter")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br")])]),a("h3",{attrs:{id:"core-instance-index-js"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#core-instance-index-js"}},[t._v("#")]),t._v(" core/instance/index.js")]),t._v(" "),a("p",[t._v("Vue构造函数定义"),a("br"),t._v("\n定义Vue实例API")]),t._v(" "),a("div",{staticClass:"language-js line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("Vue")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("options")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 构造函数仅执行了_init")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("_init")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("options"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("initMixin")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("Vue"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 实现init函数")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("stateMixin")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("Vue"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 状态相关api $data,$props,$set,$delete,$watch")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("eventsMixin")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("Vue"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 事件相关api $on,$once,$off,$emit")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("lifecycleMixin")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("Vue"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 生命周期api _update,$forceUpdate,$destroy")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("renderMixin")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("Vue"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 渲染api _render,$nextTick")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br"),a("span",{staticClass:"line-number"},[t._v("8")]),a("br"),a("span",{staticClass:"line-number"},[t._v("9")]),a("br")])]),a("h3",{attrs:{id:"core-instance-init-js"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#core-instance-init-js"}},[t._v("#")]),t._v(" core/instance/init.js")]),t._v(" "),a("p",[t._v("创建组件实例，初始化其数据、属性、事件等")]),t._v(" "),a("div",{staticClass:"language-js line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[t._v("initLifecycle")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("vm"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// $parent,$root,$children,$refs")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("initEvents")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("vm"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 处理父组件传递的事件和回调")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("initRender")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("vm"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// $slots,$scopedSlots,_c,$createElement")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("callHook")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("vm"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'beforeCreate'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("initInjections")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("vm"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 获取注入数据")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("initState")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("vm"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 初始化props，methods，data，computed，watch")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("initProvide")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("vm"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 提供数据注入")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("callHook")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("vm"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'created'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br"),a("span",{staticClass:"line-number"},[t._v("8")]),a("br")])]),a("h3",{attrs:{id:"mount"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#mount"}},[t._v("#")]),t._v(" $mount")]),t._v(" "),a("ul",[a("li",[a("p",[t._v("mountComponent\n执行挂载，获取vdom并转换为dom")])]),t._v(" "),a("li",[a("p",[t._v("new Watcher()\n创建组件渲染watcher")])]),t._v(" "),a("li",[a("p",[t._v("update()\n初始化或更新，将传入vdom转换为dom，初始化时执行的是dom创建操作")])]),t._v(" "),a("li",[a("p",[t._v("render() src\\core\\instance\\render.js\n渲染组件，获取vdom")])])]),t._v(" "),a("h3",{attrs:{id:"整体流程-2"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#整体流程-2"}},[t._v("#")]),t._v(" 整体流程")]),t._v(" "),a("p",[t._v("new Vue() => _init() => $mount() => mountComponent() =>\nnew Watcher() => updateComponent() => render() => _update()")]),t._v(" "),a("blockquote",[a("ul",[a("li",[t._v("思考一道相关面试题：谈谈vue生命周期\n"),a("ul",[a("li",[t._v("概念：组件创建、更新和销毁过程")]),t._v(" "),a("li",[t._v("用途：生命周期钩子使我们可以在合适的时间做合适的事情\n"),a("ul",[a("li",[t._v("分类列举：")]),t._v(" "),a("li",[t._v("初始化阶段：beforeCreate、created、beforeMount、mounted")]),t._v(" "),a("li",[t._v("更新阶段：beforeUpdate、updated")]),t._v(" "),a("li",[t._v("销毁阶段：beforeDestroy、destroyed")])])]),t._v(" "),a("li",[t._v("应用：\n"),a("ul",[a("li",[t._v("created时，所有数据准备就绪，适合做数据获取、赋值等数据操作")]),t._v(" "),a("li",[t._v("mounted时，$el已生成，可以获取dom；子组件也已挂载，可以访问它们")]),t._v(" "),a("li",[t._v("updated时，数值变化已作用于dom，可以获取dom最新状态")]),t._v(" "),a("li",[t._v("destroyed时，组件实例已销毁，适合取消定时器等操作")])])])])])])]),t._v(" "),a("h3",{attrs:{id:"数据响应式"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#数据响应式"}},[t._v("#")]),t._v(" 数据响应式")]),t._v(" "),a("p",[t._v("数据响应式是MVVM框架的一大特点，通过某种策略可以感知数据的变化。Vue中利用了JS语言特性\nObject.defineProperty()，通过定义对象属性getter/setter拦截对属性的访问。"),a("br"),t._v("\n具体实现是在Vue初始化时，会调用initState，它会初始化data，props等，这里着重关注data初始\n化，")]),t._v(" "),a("h3",{attrs:{id:"整体流程-3"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#整体流程-3"}},[t._v("#")]),t._v(" 整体流程")]),t._v(" "),a("p",[t._v("initState (vm: Component) src\\core\\instance\\state.js\n初始化数据，包括props、methods、data、computed和watch")]),t._v(" "),a("h4",{attrs:{id:"initdata核心代码是将data数据响应化"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#initdata核心代码是将data数据响应化"}},[t._v("#")]),t._v(" initData核心代码是将data数据响应化")]),t._v(" "),a("div",{staticClass:"language-js line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("initData")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("vm"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" Component")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 执行数据响应化")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("observe")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("data"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/* asRootData */")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br")])]),a("h4",{attrs:{id:"core-observer-index-js"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#core-observer-index-js"}},[t._v("#")]),t._v(" core/observer/index.js")]),t._v(" "),a("p",[t._v("observe方法返回一个Observer实例")]),t._v(" "),a("h4",{attrs:{id:"core-observer-index-js-2"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#core-observer-index-js-2"}},[t._v("#")]),t._v(" core/observer/index.js")]),t._v(" "),a("p",[t._v("Observer对象根据数据类型执行对应的响应化操作\ndefineReactive定义对象属性的getter/setter，getter负责添加依赖，setter负责通知更新")]),t._v(" "),a("h4",{attrs:{id:"core-observer-dep-js"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#core-observer-dep-js"}},[t._v("#")]),t._v(" core/observer/dep.js")]),t._v(" "),a("p",[t._v("Dep负责管理一组Watcher，包括watcher实例的增删及通知更新\n"),a("img",{attrs:{src:"/vue/04.png",alt:"dep.js"}})]),t._v(" "),a("h4",{attrs:{id:"watcher"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#watcher"}},[t._v("#")]),t._v(" Watcher")]),t._v(" "),a("p",[t._v("Watcher解析一个表达式并收集依赖，当数值变化时触发回调函数，常用于$watch API和指令中。\n每个组件也会有对应的Watcher，数值变化会触发其update函数导致重新渲染")]),t._v(" "),a("div",{staticClass:"language-js line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("export")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("default")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Watcher")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("constructor")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("get")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("addDep")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("dep"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" Dep")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("update")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br")])]),a("blockquote",[a("p",[t._v("相关API： $watcher")])]),t._v(" "),a("p",[a("img",{attrs:{src:"/vue/05.png",alt:"watcher"}})]),t._v(" "),a("h3",{attrs:{id:"数组响应化"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#数组响应化"}},[t._v("#")]),t._v(" 数组响应化")]),t._v(" "),a("p",[t._v("数组数据变化的侦测跟对象不同，我们操作数组通常使用push、pop、splice等方法，此时没有办法得\n知数据变化。所以vue中采取的策略是拦截这些方法并通知dep。")]),t._v(" "),a("h4",{attrs:{id:"src-core-observer-array-js"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#src-core-observer-array-js"}},[t._v("#")]),t._v(" src\\core\\observer\\array.js")]),t._v(" "),a("p",[t._v("为数组原型中的7个可以改变内容的方法定义拦截器")]),t._v(" "),a("h4",{attrs:{id:"observer中覆盖数组原型"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#observer中覆盖数组原型"}},[t._v("#")]),t._v(" Observer中覆盖数组原型")]),t._v(" "),a("div",{staticClass:"language-js line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("Array"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("isArray")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("value"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 替换数组原型")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("protoAugment")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("value"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" arrayMethods"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// value.__proto__ = arrayMethods")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("observeArray")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("value"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br")])]),a("blockquote",[a("p",[t._v("相关API： Vue.set()/delete()")])]),t._v(" "),a("div",{staticClass:"language-js line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[t._v("data"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  arr"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\narr"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("length "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("\narr"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("index"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" xxx\nVue"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("set")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\nVue"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("del")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br")])])])}),[],!1,null,null,null);s.default=e.exports}}]);